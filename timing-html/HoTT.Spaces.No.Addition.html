<html>
<head>
<title>Addition.v</title>
<style>
.time {
  background-color: #ffaaaa;
  height: 100%;
  z-index: -1;
  position: absolute;
}
.code {
  z-index: 0;
  position: relative;
  border-style: solid;
  border-color: transparent;
  border-width: 1px;
}
.code:hover {
  border-style: solid;
  border-color: black;
  border-width: 1px;
}
pre {
  margin: 1px;
}
</style>
</head>
<body>
<h1>Timings for Addition.v</h1>

<div class="code" title="File: Addition.v
Line: 1
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>(* -*- mode: coq; mode: visual-line -*- *)</pre>
</div>
<div class="code" title="File: Addition.v
Line: 1
Time: 0.044s">
<div class="time" style="width: 17.254901960784%"></div>
<pre>Require Import HoTT.Basics HoTT.Types.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 1
Time: 0.207s">
<div class="time" style="width: 81.176470588235%"></div>
<pre>
Require Import HoTT.Spaces.No.Core.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 2
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Local Open Scope path_scope.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 4
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Local Open Scope surreal_scope.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 5
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** * Addition of surreal numbers *)

(** Addition requires the option sorts to be closed under finite sums. *)</pre>
</div>
<div class="code" title="File: Addition.v
Line: 9
Time: 0.002s">
<div class="time" style="width: 0.7843137254902%"></div>
<pre>Class HasAddition (S : OptionSort) := 
  { empty_options : InSort S Empty Empty
    ; sum_options : forall L R L' R',
        InSort S L R -&gt; InSort S L' R' -&gt; InSort S (L + L') (R + R')
  }.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 13
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Existing Instance empty_options.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 14
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Existing Instance sum_options.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 15
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Global Instance hasaddition_maxsort : HasAddition MaxSort
  := { empty_options := tt ;
       sum_options := fun _ _ _ _ _ _ =&gt; tt }.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 19
Time: 0.001s">
<div class="time" style="width: 0.3921568627451%"></div>
<pre>
  
Global Instance hasaddition_ordsort : HasAddition OrdSort
  := { empty_options := idmap ;
       sum_options := fun _ _ _ _ f g =&gt; sum_ind _ f g }.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 23
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Global Instance hasaddition_decsort : HasAddition DecSort.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 25
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 26
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  constructor.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 27
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Addition.v
Line: 28
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply insort_decsort.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 28
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Addition.v
Line: 29
Time: 0.02s">
<div class="time" style="width: 7.843137254902%"></div>
<pre> intros L R L' R' [? ?] [? ?]; split; exact _.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 29
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 30
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Section Addition.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 32
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context `{Univalence}.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 33
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context {S : OptionSort@{i}} `{HasAddition S}.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 34
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Let No := GenNo S.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 35
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Section Inner.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 37
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    Context {L R : Type@{i} } {Sx : InSort@{i} S L R}
            (xL : L -&gt; No@{i}) (xR : R -&gt; No@{i})
            (xcut : forall (l : L) (r : R), xL l &lt; xR r).</pre>
</div>
<div class="code" title="File: Addition.v
Line: 41
Time: 0.001s">
<div class="time" style="width: 0.3921568627451%"></div>
<pre>

    Let A := {g : No@{i} -&gt; No@{i} &amp;
              (forall x y : No@{i}, x &lt;= y -&gt; g x &lt;= g y) *
              (forall x y : No@{i}, x &lt; y -&gt; g x &lt; g y)}.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 45
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    Context (xL_plus : L -&gt; A) (xR_plus : R -&gt; A)
            (xL_lt_xR_plus : forall (l : L) (r : R) (x : No),
                               (xL_plus l).1 x &lt; (xR_plus r).1 x).</pre>
</div>
<div class="code" title="File: Addition.v
Line: 49
Time: 0.003s">
<div class="time" style="width: 1.1764705882353%"></div>
<pre>

    Definition plus_inner
    : { g : forall (y : No@{i}),
              { x_plus_y : No@{i} &amp;
                (forall l, (xL_plus l).1 y &lt; x_plus_y) *
                (forall r, x_plus_y &lt; (xR_plus r).1 y) } &amp;
        (forall y z : No, y &lt;= z -&gt; (g y).1 &lt;= (g z).1) *
        (forall y z : No, y &lt;  z -&gt; (g y).1 &lt;  (g z).1) }.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 57
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 58
Time: 0.156s">
<div class="time" style="width: 61.176470588235%"></div>
<pre>
      simple refine (No_ind_package
                (fun y =&gt; { x_plus_y : No &amp;
                            (forall l, (xL_plus l).1 y &lt; x_plus_y) *
                            (forall r, x_plus_y &lt; (xR_plus r).1 y) })
                (fun _ _ _ z w =&gt; z.1 &lt;= w.1)
                (fun _ _ _ z w =&gt; z.1 &lt; w.1)
                _ _ _ _ _).</pre>
</div>
<div class="code" title="File: Addition.v
Line: 65
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Addition.v
Line: 66
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros L' R' ? yL yR ycut x_plus_yL x_plus_yR x_plus_yL_lt_yR.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 66
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        pose (L'' := L + L').</pre>
</div>
<div class="code" title="File: Addition.v
Line: 67
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>  pose (R'' := R + R').</pre>
</div>
<div class="code" title="File: Addition.v
Line: 67
Time: 0.001s">
<div class="time" style="width: 0.3921568627451%"></div>
<pre>
        pose (zL := sum_ind (fun _ =&gt; No)
                            (fun l =&gt; (xL_plus l).1 {{ yL | yR // ycut }})
                            (fun l =&gt; (x_plus_yL l).1)
                    : L'' -&gt; No).</pre>
</div>
<div class="code" title="File: Addition.v
Line: 71
Time: 0.001s">
<div class="time" style="width: 0.3921568627451%"></div>
<pre>
        pose (zR := sum_ind (fun _ =&gt; No)
                            (fun r =&gt; (xR_plus r).1 {{ yL | yR // ycut }})
                            (fun r =&gt; (x_plus_yR r).1)
                    : R'' -&gt; No).</pre>
</div>
<div class="code" title="File: Addition.v
Line: 75
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        assert (zcut : forall (l:L'') (r:R''), zL l &lt; zR r).</pre>
</div>
<div class="code" title="File: Addition.v
Line: 76
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        {</pre>
</div>
<div class="code" title="File: Addition.v
Line: 77
Time: 0.024s">
<div class="time" style="width: 9.4117647058824%"></div>
<pre> abstract (
          intros [l|l] [r|r]; cbn;
          [ apply xL_lt_xR_plus
          | transitivity ((xL_plus l).1 (yR r));
            [ apply (snd (xL_plus l).2), lt_ropt; exact _
            | exact (fst (x_plus_yR r).2 l) ]
          | transitivity ((xR_plus r).1 (yL l));
            [ exact (snd (x_plus_yL l).2 r)
            | apply (snd (xR_plus r).2), lt_lopt; exact _ ]
          | apply x_plus_yL_lt_yR ]).</pre>
</div>
<div class="code" title="File: Addition.v
Line: 86
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Addition.v
Line: 86
Time: 0.001s">
<div class="time" style="width: 0.3921568627451%"></div>
<pre>
        assert (InSort S L'' R'') by (apply sum_options; exact _).</pre>
</div>
<div class="code" title="File: Addition.v
Line: 87
Time: 0.001s">
<div class="time" style="width: 0.3921568627451%"></div>
<pre>
        exists ({{ zL | zR // zcut }}); split.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 88
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        +</pre>
</div>
<div class="code" title="File: Addition.v
Line: 89
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros l.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 89
Time: 0.003s">
<div class="time" style="width: 1.1764705882353%"></div>
<pre>
          refine (lt_lopt zL zR zcut (inl l)).</pre>
</div>
<div class="code" title="File: Addition.v
Line: 90
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        +</pre>
</div>
<div class="code" title="File: Addition.v
Line: 91
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros r.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 91
Time: 0.003s">
<div class="time" style="width: 1.1764705882353%"></div>
<pre>
          refine (lt_ropt zL zR zcut (inl r)).</pre>
</div>
<div class="code" title="File: Addition.v
Line: 92
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Addition.v
Line: 93
Time: 0.093s">
<div class="time" style="width: 36.470588235294%"></div>
<pre> abstract (
        intros x y [a ?] [b ?] p q r s;
        rewrite transport_sigma; cbn in *;
        apply path_sigma_hprop, path_No; cbn;
        rewrite transport_const; assumption).</pre>
</div>
<div class="code" title="File: Addition.v
Line: 97
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Addition.v
Line: 98
Time: 0.054s">
<div class="time" style="width: 21.176470588235%"></div>
<pre> abstract (
        intros L' R' ? yL yR ycut x_plus_yL x_plus_yR x_plus_yL_lt_yR
               L'' R'' ? zL zR zcut x_plus_zL x_plus_zR x_plus_zL_lt_zR
               yL_lt_z x_plus_yL_lt_z y_lt_zR x_plus_y_lt_zR;
        cbn in *;
        apply le_lr; [ intros [l|l] | intros [r|r] ]; cbn;
        [ refine (le_lt_trans (fst (xL_plus l).2 _ {{ zL | zR // zcut}} _) _);
          [ by (apply le_lr; assumption)
          | refine (lt_lopt _ _ _ (inl l)) ]
        | exact (x_plus_yL_lt_z l)
        | refine (lt_le_trans _
                    (fst (xR_plus r).2 {{ yL | yR // ycut}} _ _));
          [ refine (lt_ropt _ _ _ (inl r))
          | by (apply le_lr; assumption) ]
        | exact (x_plus_y_lt_zR r) ] ).</pre>
</div>
<div class="code" title="File: Addition.v
Line: 112
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Addition.v
Line: 113
Time: 0.02s">
<div class="time" style="width: 7.843137254902%"></div>
<pre> abstract (
        intros L' R' ? yL yR ycut x_plus_yL x_plus_yR x_plus_yL_lt_yR
               L'' R'' ? zL zR zcut x_plus_zL x_plus_zR x_plus_zL_lt_zR
               l y_le_zL x_plus_y_le_zL; cbn;
        apply lt_l with (inr l);
        apply x_plus_y_le_zL ).</pre>
</div>
<div class="code" title="File: Addition.v
Line: 118
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Addition.v
Line: 119
Time: 0.036s">
<div class="time" style="width: 14.117647058824%"></div>
<pre> abstract (
        intros L' R' ? yL yR ycut x_plus_yL x_plus_yR x_plus_yL_lt_yR
               L'' R'' ? zL zR zcut x_plus_zL x_plus_zR x_plus_zL_lt_zR
               r yR_le_z x_plus_yR_le_z; cbn;
        apply lt_r with (inr r);
        apply x_plus_yR_le_z).</pre>
</div>
<div class="code" title="File: Addition.v
Line: 124
Time: 0.005s">
<div class="time" style="width: 1.9607843137255%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 125
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** We now prove a computation law for [plus_inner].  It holds definitionally, so we would like to prove it with just [:= 1] and then rewrite along it later, as we did above.  However, there is a subtlety in that the output should be a surreal defined by a cut, which in particular includes a proof of cut-ness, and that proof is rather long, so we would not like to see it in the type of this lemma.  Thus, instead we assert only that there *exists* some proof of cut-ness and an equality. *)
   </pre>
</div>
<div class="code" title="File: Addition.v
Line: 128
Time: 0.021s">
<div class="time" style="width: 8.2352941176471%"></div>
<pre>Definition plus_inner_cut
               {L' R' : Type@{i} } {Sy : InSort@{i} S L' R'}
               (yL : L' -&gt; No@{i}) (yR : R' -&gt; No@{i})
               (ycut : forall (l : L') (r : R'), yL l &lt; yR r)
    : let L'' := L + L' in
      let R'' := R + R' in
      let zL := sum_ind (fun _ =&gt; No)
                        (fun l =&gt; (xL_plus l).1 {{ yL | yR // ycut }})
                        (fun l =&gt; (plus_inner.1 (yL l)).1)
                : L'' -&gt; No in
      let zR := sum_ind (fun _ =&gt; No)
                        (fun r =&gt; (xR_plus r).1 {{ yL | yR // ycut }})
                        (fun r =&gt; (plus_inner.1 (yR r)).1)
                : R'' -&gt; No in
      let Sz := sum_options L R L' R' _ _ in 
      { zcut : forall (l:L'') (r:R''), zL l &lt; zR r &amp;
        (plus_inner.1 {{ yL | yR // ycut }}).1 = (@No_cut _ _ _ Sz zL zR zcut) }.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 144
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 145
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (** Now we tell Coq that we want the equality to be definitional, and let it figure out what the proof of cut-ness has to be. *)
     </pre>
</div>
<div class="code" title="File: Addition.v
Line: 147
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>eexists.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 147
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (** Adding [rel_hnf] here speeds things up considerably, possibly because it puts the terms in a form where the evar can be instantiated without unfolding or reduction, preventing backtracking across the evar instantiation. *)
     </pre>
</div>
<div class="code" title="File: Addition.v
Line: 149
Time: 0.011s">
<div class="time" style="width: 4.3137254901961%"></div>
<pre>rel_hnf.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 149
Time: 0.029s">
<div class="time" style="width: 11.372549019608%"></div>
<pre> reflexivity.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 149
Time: 0.053s">
<div class="time" style="width: 20.78431372549%"></div>
<pre>
    Qed.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 150
Time: 0.011s">
<div class="time" style="width: 4.3137254901961%"></div>
<pre>

  End Inner.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 152
Time: 0.003s">
<div class="time" style="width: 1.1764705882353%"></div>
<pre>

  Definition plus_outer
  : { f : No@{i} -&gt; { g : No@{i} -&gt; No@{i} &amp;
                  (forall x y, x &lt;= y -&gt; g x &lt;= g y) *
                  (forall x y, x &lt;  y -&gt; g x &lt;  g y) } &amp;
      (forall x y, x &lt;= y -&gt; forall z, (f x).1 z &lt;= (f y).1 z) *
      (forall x y, x &lt;  y -&gt; forall z, (f x).1 z &lt;  (f y).1 z) }.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 159
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 160
Time: 0.078s">
<div class="time" style="width: 30.588235294118%"></div>
<pre>
    refine (No_rec_package
              {g : No -&gt; No &amp;
                (forall x y, x &lt;= y -&gt; g x &lt;= g y) *
                (forall x y, x &lt;  y -&gt; g x &lt;  g y) }
              (fun g h =&gt; forall x, g.1 x &lt;= h.1 x)
              (fun g h =&gt; forall x, g.1 x &lt;  h.1 x)
              (fun L R Sx xL xR xcut xL_plus xR_plus xL_lt_xR_plus =&gt;
                 let g := plus_inner xL_plus xR_plus xL_lt_xR_plus in
                 ((fun y =&gt; (g.1 y).1) ; (g.2)))
               _ _ _ _).</pre>
</div>
<div class="code" title="File: Addition.v
Line: 170
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Addition.v
Line: 171
Time: 0.157s">
<div class="time" style="width: 61.56862745098%"></div>
<pre> abstract (
      intros [g ?] [h ?] p q;
      apply path_sigma_hprop; cbn in *;
      apply path_arrow; intros x;
      apply path_No; [ apply p | apply q ] ).</pre>
</div>
<div class="code" title="File: Addition.v
Line: 175
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Addition.v
Line: 176
Time: 0.255s">
<div class="time" style="width: 100%"></div>
<pre> abstract (
      intros L R ? xL xR xcut xL_plus xR_plus xL_lt_xR_plus
           L' R' ? yL yR ycut yL_plus yR_plus yL_lt_yR_plus;
      intros xL_lt_y xL_lt_y_plus x_lt_yR x_lt_yR_plus z;
      lazy beta zeta in *; cbn [pr1] in *;
      pattern z; refine (No_ind_hprop _ _ z);
      intros L'' R'' ? zL zR zcut x_le_y_plus_zL x_le_y_plus_zR;
      destruct (plus_inner_cut xL_plus xR_plus xL_lt_xR_plus
                               zL zR zcut) as [xzcut p]; rewrite p;
      destruct (plus_inner_cut yL_plus yR_plus yL_lt_yR_plus
                               zL zR zcut) as [yzcut q];rewrite q;
      apply le_lr; [ intros [l|l] | intros [r|r] ];
      [ (** x^L + z &lt; y + z *)
        specialize (xL_lt_y_plus l {{ zL | zR // zcut }});
        rewrite q in xL_lt_y_plus;
        exact xL_lt_y_plus
      | (** x + z^L &lt; y + z *)
        refine (le_lt_trans (x_le_y_plus_zL l) _);
        refine (lt_lopt _ _ _ (inr l))
      | (** x + z &lt; y^R + z *)
        specialize (x_lt_yR_plus r {{ zL | zR // zcut }});
        rewrite p in x_lt_yR_plus;
        exact x_lt_yR_plus
      | (** x + z &lt; y + z^R *)
        refine (lt_le_trans _ (x_le_y_plus_zR r));
        refine (lt_ropt _ _ _ (inr r)) ]).</pre>
</div>
<div class="code" title="File: Addition.v
Line: 201
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Addition.v
Line: 202
Time: 0.22s">
<div class="time" style="width: 86.274509803922%"></div>
<pre> abstract (
      intros L R ? xL xR xcut xL_plus xR_plus xL_lt_xR_plus
             L' R' ? yL yR ycut yL_plus yR_plus yL_lt_yR_plus;
      intros l x_le_yL x_le_yL_plus z;
      lazy beta zeta in *; cbn [pr1] in *;
      pattern z; refine (No_ind_hprop _ _ z);
      intros L'' R'' ? zL zR zcut x_le_y_plus_zL x_le_y_plus_zR;
      destruct (plus_inner_cut xL_plus xR_plus xL_lt_xR_plus
                               zL zR zcut) as [xzcut p]; rewrite p;
      destruct (plus_inner_cut yL_plus yR_plus yL_lt_yR_plus
                               zL zR zcut) as [yzcut q];rewrite q;
      refine (le_lt_trans (x_le_yL_plus {{ zL | zR // zcut }}) _);
      refine (lt_lopt _ _ _ (inl l)) ).</pre>
</div>
<div class="code" title="File: Addition.v
Line: 214
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Addition.v
Line: 215
Time: 0.213s">
<div class="time" style="width: 83.529411764706%"></div>
<pre> abstract (
      intros L R ? xL xR xcut xL_plus xR_plus xL_lt_xR_plus
             L' R' ? yL yR ycut yL_plus yR_plus yL_lt_yR_plus;
      intros r xR_le_y xR_le_y_plus z;
      lazy beta zeta in *; cbn [pr1] in *;
      pattern z; refine (No_ind_hprop _ _ z);
      intros L'' R'' ? zL zR zcut x_le_y_plus_zL x_le_y_plus_zR;
      destruct (plus_inner_cut xL_plus xR_plus xL_lt_xR_plus
                               zL zR zcut) as [xzcut p]; rewrite p;
      destruct (plus_inner_cut yL_plus yR_plus yL_lt_yR_plus
                               zL zR zcut) as [yzcut q];rewrite q;
      refine (lt_le_trans _ (xR_le_y_plus {{ zL | zR // zcut }}));
      refine (lt_ropt _ _ _ (inl r)) ).</pre>
</div>
<div class="code" title="File: Addition.v
Line: 227
Time: 0.022s">
<div class="time" style="width: 8.6274509803922%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 228
Time: 0.014s">
<div class="time" style="width: 5.4901960784314%"></div>
<pre>

  Definition plus (x y : No) : No
    := (plus_outer.1 x).1 y.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 231
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Infix "+" := plus : surreal_scope.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 233
Time: 0.03s">
<div class="time" style="width: 11.764705882353%"></div>
<pre>

  Definition plus_le_l (x x' y : No@{i}) (p : x &lt;= x')
  : (x + y) &lt;= (x' + y)
    := fst (plus_outer.2) x x' p y.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 237
Time: 0.033s">
<div class="time" style="width: 12.941176470588%"></div>
<pre>

  Definition plus_lt_l (x x' y : No@{i}) (p : x &lt; x')
  : (x + y) &lt; (x' + y)
    := snd (plus_outer.2) x x' p y.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 241
Time: 0.039s">
<div class="time" style="width: 15.294117647059%"></div>
<pre>

  Definition plus_le_r (x y y' : No@{i}) (p : y &lt;= y')
  : (x + y) &lt;= (x + y')
    := fst (plus_outer.1 x).2 y y' p.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 245
Time: 0.035s">
<div class="time" style="width: 13.725490196078%"></div>
<pre>

  Definition plus_lt_r (x y y' : No@{i}) (p : y &lt; y')
  : (x + y) &lt; (x + y')
    := snd (plus_outer.1 x).2 y y' p.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 249
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** See the remarks above [plus_inner_cut] to explain the type of this lemma. *)
 </pre>
</div>
<div class="code" title="File: Addition.v
Line: 252
Time: 0.247s">
<div class="time" style="width: 96.862745098039%"></div>
<pre>Definition plus_cut
             {L R : Type@{i} } {Sx : InSort@{i} S L R}
             (xL : L -&gt; No@{i}) (xR : R -&gt; No@{i})
             (xcut : forall (l : L) (r : R), xL l &lt; xR r)
             {L' R' : Type@{i} } {Sy : InSort@{i} S L' R'}
             (yL : L' -&gt; No@{i}) (yR : R' -&gt; No@{i})
             (ycut : forall (l : L') (r : R'), yL l &lt; yR r)
  : let L'' := (L + L')%type in
    let R'' := (R + R')%type in
    let x := {{ xL | xR // xcut }} in
    let y := {{ yL | yR // ycut }} in
    let zL := sum_ind (fun _ =&gt; No)
                      (fun l =&gt; (xL l) + y) (fun l =&gt; x + (yL l))
              : L'' -&gt; No in
    let zR := sum_ind (fun _ =&gt; No)
                      (fun r =&gt; (xR r) + y) (fun r =&gt; x + (yR r))
              : R'' -&gt; No in
    let Sz := sum_options L R L' R' _ _ in 
    { zcut : forall (l:L'') (r:R''), zL l &lt; zR r &amp;
      x + y = @No_cut _ _ _ Sz zL zR zcut }
    := plus_inner_cut (Sx := Sx)
         (fun l =&gt; plus_outer.1 (xL l))
         (fun r =&gt; plus_outer.1 (xR r))
         (fun l r =&gt; snd plus_outer.2 (xL l) (xR r) (xcut l r))
         yL yR ycut.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 276
Time: 0.1s">
<div class="time" style="width: 39.21568627451%"></div>
<pre>

End Addition.</pre>
</div>
<div class="code" title="File: Addition.v
Line: 279
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

</pre>
</div>
</body>
</html>

