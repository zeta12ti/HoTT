<html>
<head>
<title>Accessible.v</title>
<style>
.time {
  background-color: #ffaaaa;
  height: 100%;
  z-index: -1;
  position: absolute;
}
.code {
  z-index: 0;
  position: relative;
  border-style: solid;
  border-color: transparent;
  border-width: 1px;
}
.code:hover {
  border-style: solid;
  border-color: black;
  border-width: 1px;
}
pre {
  margin: 1px;
}
</style>
</head>
<body>
<h1>Timings for Accessible.v</h1>

<div class="code" title="File: Accessible.v
Line: 1
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>(* -*- mode: coq; mode: visual-line -*- *)

(** * Accessible subuniverses and modalities *)

</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 4
Time: 0.049s">
<div class="time" style="width: 20.164609053498%"></div>
<pre>Require Import HoTT.Basics HoTT.Types HoTT.Tactics.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 4
Time: 0.008s">
<div class="time" style="width: 3.2921810699588%"></div>
<pre>
Require Import Extensions NullHomotopy EquivalenceVarieties.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 5
Time: 0.015s">
<div class="time" style="width: 6.1728395061728%"></div>
<pre>
Require Import ReflectiveSubuniverse Modality.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 6
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Local Open Scope nat_scope.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 8
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Local Open Scope path_scope.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 9
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>


(** ** Accessible reflective subuniverses *)

(** An accessible reflective subuniverse is one that is the localization at a small family of maps.  Accessibility is necessary for some constructions, and in practice it's a reasonable hypothesis that includes most examples (though a few examples, such as double negation, may only be accessible if we assume propositional resizing).

We now give the basic definitions related to accessibility, using [ooExtendableAlong] as our notion of equivalence as we did with reflective subuniverses.  The actual construction of a reflective subuniverse by localization will be in [Localization]. *)

</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 17
Time: 0.002s">
<div class="time" style="width: 0.82304526748971%"></div>
<pre>Record LocalGenerators :=
  { lgen_indices : Type@{a} ;
    lgen_domain : lgen_indices -&gt; Type@{a} ;
    lgen_codomain : lgen_indices -&gt; Type@{a} ;
    lgenerator : forall i, lgen_domain i -&gt; lgen_codomain i
  }.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 22
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Coercion lgenerator : LocalGenerators &gt;-&gt; Funclass.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 24
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** We put this definition in a module so that no one outside of this file will use it accidentally.  It will be redefined in [Localization] to refer to the localization reflective subuniverse, which is judgmentally the same but will also pick up typeclass inference for [In]. *)</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 26
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Module Import IsLocal_Internal.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 26
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition IsLocal f X :=
    (forall (i : lgen_indices f), ooExtendableAlong (f i) (fun _ =&gt; X)).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 28
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
End IsLocal_Internal.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 29
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Module Type Accessible_ReflectiveSubuniverses
       (Os : ReflectiveSubuniverses).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 32
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Export Os.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 34
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** In examples (such as localization), the reason we need the extra universe parameter [a] is that it describes the size of the generators.  Therefore, here we intentionally collapse that parameter with the parameter of [LocalGenerators]. *)
 </pre>
</div>
<div class="code" title="File: Accessible.v
Line: 37
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Parameter acc_gen : ReflectiveSubuniverse@{u a} -&gt; LocalGenerators@{a}.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 37
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Check acc_gen@{u a}.    (** Verify that we have the right number of universes *)

 </pre>
</div>
<div class="code" title="File: Accessible.v
Line: 40
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Parameter inO_iff_islocal
  : forall (O : ReflectiveSubuniverse@{u a}) (X : Type@{i}),
      (** We call [iff] explicitly to control the number of universe parameters. *)
      iff@{i i i}
         (In@{u a i} O X)
         (IsLocal@{i i a} (acc_gen@{u a} O) X).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 45
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Check inO_iff_islocal@{u a i}.

</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 47
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>End Accessible_ReflectiveSubuniverses.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 47
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Module Accessible_ReflectiveSubuniverses_Theory
       (Os : ReflectiveSubuniverses)
       (Acc : Accessible_ReflectiveSubuniverses Os).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 51
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Import Os Acc.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 53
Time: 0.068s">
<div class="time" style="width: 27.98353909465%"></div>
<pre>
  Module Import Os_Theory := ReflectiveSubuniverses_Theory Os.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 54
Time: 0.001s">
<div class="time" style="width: 0.41152263374486%"></div>
<pre>

  Definition O_inverts_generators {O : ReflectiveSubuniverse}
             (i : lgen_indices (acc_gen O))
  : O_inverts O (acc_gen O i).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 58
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 59
Time: 0.001s">
<div class="time" style="width: 0.41152263374486%"></div>
<pre>
    pose (ext_dom := fst (inO_iff_islocal O (O (lgen_domain (acc_gen O) i))) _).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 60
Time: 0.001s">
<div class="time" style="width: 0.41152263374486%"></div>
<pre>
    pose (ext_cod := fst (inO_iff_islocal O (O (lgen_codomain (acc_gen O) i))) _).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 61
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    simple refine (isequiv_adjointify _ _ _ _).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 62
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 63
Time: 0.001s">
<div class="time" style="width: 0.41152263374486%"></div>
<pre> apply O_rec.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 63
Time: 0.001s">
<div class="time" style="width: 0.41152263374486%"></div>
<pre>
      exact ((fst (ext_dom i 1%nat) (to O _)).1).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 64
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 65
Time: 0.002s">
<div class="time" style="width: 0.82304526748971%"></div>
<pre> apply O_indpaths; intros x; simpl.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 65
Time: 0.002s">
<div class="time" style="width: 0.82304526748971%"></div>
<pre>
      rewrite O_rec_beta.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 66
Time: 0.005s">
<div class="time" style="width: 2.0576131687243%"></div>
<pre>
      refine ((fst (snd (ext_cod i 2)
                        (fun x =&gt; O_functor O (acc_gen O i)
                                            ((fst (ext_dom i 1%nat) (to O _)).1 x))
                        _) _).1 x); intros a.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 70
Time: 0.004s">
<div class="time" style="width: 1.6460905349794%"></div>
<pre>
      rewrite ((fst (ext_dom i 1%nat) (to O _)).2 a).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 71
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply to_O_natural.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 72
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 73
Time: 0.003s">
<div class="time" style="width: 1.2345679012346%"></div>
<pre> apply O_indpaths; intros x; simpl.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 73
Time: 0.003s">
<div class="time" style="width: 1.2345679012346%"></div>
<pre>
      rewrite (to_O_natural O (acc_gen O i) x).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 74
Time: 0.002s">
<div class="time" style="width: 0.82304526748971%"></div>
<pre>
      rewrite O_rec_beta.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 75
Time: 0.001s">
<div class="time" style="width: 0.41152263374486%"></div>
<pre>
      apply ((fst (ext_dom i 1%nat) (to O _)).2 x).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 76
Time: 0.013s">
<div class="time" style="width: 5.3497942386831%"></div>
<pre>
  Qed.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 77
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

End Accessible_ReflectiveSubuniverses_Theory.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 79
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** The construction of the localization reflective subuniverse for any family of maps will be in [Localization]. *)


(** ** Accessible modalities *)

(** A modality is accessible just when its underlying reflective subuniverse is accessible.  However, for modalities we have a simpler characterization in terms of families of generating connected objects rather than families of generating inverted maps.  We call an object [S]-null if it is local with respect to the maps [S i -&gt; Unit]. *)

</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 87
Time: 0.001s">
<div class="time" style="width: 0.41152263374486%"></div>
<pre>Record NullGenerators :=
  { ngen_indices : Type@{a} ;
    ngen_type : ngen_indices -&gt; Type@{a}
  }.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 90
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Coercion ngen_type : NullGenerators &gt;-&gt; Funclass.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 92
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition null_to_local_generators : NullGenerators@{a1} -&gt; LocalGenerators@{a2}
  := fun S =&gt; Build_LocalGenerators (ngen_indices S) (ngen_type S) (fun _ =&gt; Unit) (fun _ _ =&gt; tt).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 95
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** As with [IsLocal], the real version of this notation will be defined in [Nullification]. *)</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 97
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Module Import IsNull_Internal.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 97
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Definition IsNull (S : NullGenerators@{a}) (X : Type@{i})
    := IsLocal@{i i a} (null_to_local_generators@{a a} S) X.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 99
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
End IsNull_Internal.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 100
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** A central fact: if a type [X] is null for all the fibers of a map [f], then it is [f]-local.  (NB: the converse is *not* generally true.)  TODO: Should this go in [Extensions]? *)</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 102
Time: 0.001s">
<div class="time" style="width: 0.41152263374486%"></div>
<pre>Definition extendable_isnull_fibers (n : nat)
           {A B} (f : A -&gt; B) (C : B -&gt; Type)
: (forall b, ooExtendableAlong (@const (hfiber f b) Unit tt)
                               (fun _ =&gt; C b))
  -&gt; ExtendableAlong n f C.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 106
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 107
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  revert C.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 108
Time: 0.002s">
<div class="time" style="width: 0.82304526748971%"></div>
<pre>
  simple_induction n n IHn; intros C null; [exact tt | split].</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 109
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 110
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros g.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 110
Time: 0.003s">
<div class="time" style="width: 1.2345679012346%"></div>
<pre>
    exists (fun b =&gt; (fst (null b 1%nat) (fun x =&gt; x.2 # g x.1)).1 tt).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 111
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros a.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 112
Time: 0.001s">
<div class="time" style="width: 0.41152263374486%"></div>
<pre>
    rewrite (path_unit tt (const tt a)).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 113
Time: 0.001s">
<div class="time" style="width: 0.41152263374486%"></div>
<pre>
    exact ((fst (null (f a) 1%nat) _).2 (a ; 1)).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 114
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 115
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros h k.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 115
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply IHn; intros b.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 116
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply ooextendable_homotopy, null.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 117
Time: 0.004s">
<div class="time" style="width: 1.6460905349794%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 118
Time: 0.003s">
<div class="time" style="width: 1.2345679012346%"></div>
<pre>

Definition ooextendable_isnull_fibers {A B} (f : A -&gt; B) (C : B -&gt; Type)
: (forall b, ooExtendableAlong (@const (hfiber f b) Unit tt)
                               (fun _ =&gt; C b))
  -&gt; ooExtendableAlong f C
:= fun null n =&gt; extendable_isnull_fibers n f C null.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 124
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** We define a modality to be accessible if it consists of the null types for some family of generators as above. *)</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 126
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Module Type Accessible_Modalities (Os : Modalities).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 126
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Import Os.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 127
Time: 0.099s">
<div class="time" style="width: 40.740740740741%"></div>
<pre>
  Module Import Os_Theory := Modalities_Theory Os.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 128
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** See comment in [Accessible_ReflectiveSubuniverses] about collapsing universes. *)
 </pre>
</div>
<div class="code" title="File: Accessible.v
Line: 131
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Parameter acc_gen : Modality@{u a} -&gt; NullGenerators@{a}.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 131
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Check acc_gen@{u a}.    (** Verify that we have the right number of universes *)

 </pre>
</div>
<div class="code" title="File: Accessible.v
Line: 134
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Parameter inO_iff_isnull
  : forall (O : Modality@{u a}) (X : Type@{i}),
      iff@{i i i}
         (In@{u a i} O X)
         (IsNull@{a i} (acc_gen@{u a} O) X).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 138
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Check inO_iff_isnull@{u a i}.

</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 140
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>End Accessible_Modalities.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 140
Time: 0.016s">
<div class="time" style="width: 6.5843621399177%"></div>
<pre>

Module Accessible_Modalities_Theory
       (Os : Modalities)
       (Acc : Accessible_Modalities Os).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 144
Time: 0.049s">
<div class="time" style="width: 20.164609053498%"></div>
<pre>

  Export Os Acc.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 146
Time: 0.096s">
<div class="time" style="width: 39.506172839506%"></div>
<pre>
  Module Export Os_Theory := Modalities_Theory Os.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 147
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Unsurprisingly, the generators are connected. *)
 </pre>
</div>
<div class="code" title="File: Accessible.v
Line: 150
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance isconnected_acc_gen O i : IsConnected O (acc_gen O i).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 150
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 151
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply isconnected_from_elim_to_O.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 152
Time: 0.003s">
<div class="time" style="width: 1.2345679012346%"></div>
<pre>
    pose (H := fst (fst (inO_iff_isnull O (O (acc_gen O i))) _ i 1%nat)
                   (to O ((acc_gen O) i))).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 154
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exists (H.1 tt).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 155
Time: 0.001s">
<div class="time" style="width: 0.41152263374486%"></div>
<pre>
    exact (fun x =&gt; (H.2 x)^).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 156
Time: 0.001s">
<div class="time" style="width: 0.41152263374486%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 157
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** If all the generators are inhabited, some things become a bit simpler. *)
 </pre>
</div>
<div class="code" title="File: Accessible.v
Line: 160
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Section InhabitedGenerators.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 160
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    Context (O : Modality) (inhab : forall i, acc_gen O i).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 162
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** For testing modal-ness of types, it suffices for all maps out of a generator to be constant.  Probably one could do without [Funext].  *)
   </pre>
</div>
<div class="code" title="File: Accessible.v
Line: 165
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition inO_const_fromgen `{Funext} A
               (c : forall i (f : acc_gen O i -&gt; A), NullHomotopy f)
    : In O A.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 167
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 168
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply (snd (inO_iff_isnull O A)); intros i.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 169
Time: 0.243s">
<div class="time" style="width: 100%"></div>
<pre>
      apply (equiv_ooextendable_isequiv _ _)^-1.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 170
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      simple refine (isequiv_adjointify _ _ _ _).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 171
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 172
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros f []; exact (c i f).1.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 172
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 173
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros f; apply path_arrow; intros x.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 173
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        simpl; unfold composeD.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 174
Time: 0.001s">
<div class="time" style="width: 0.41152263374486%"></div>
<pre>
        symmetry; exact ((c i f).2 x).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 175
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 176
Time: 0.001s">
<div class="time" style="width: 0.41152263374486%"></div>
<pre> intros g; apply path_arrow; intros [].</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 176
Time: 0.001s">
<div class="time" style="width: 0.41152263374486%"></div>
<pre>
        pose ((c i (g oD (null_to_local_generators (acc_gen O)) i)).2).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 177
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        simpl in p; unfold composeD in p.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 178
Time: 0.002s">
<div class="time" style="width: 0.82304526748971%"></div>
<pre>
        symmetry; apply p, inhab.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 179
Time: 0.006s">
<div class="time" style="width: 2.4691358024691%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 180
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** In particular, all hprops are modal. *)
   </pre>
</div>
<div class="code" title="File: Accessible.v
Line: 183
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition inO_hprop_inhab_gen `{Funext} (A : Type) `{IsHProp A}
    : In O A.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 184
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 185
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply inO_const_fromgen; intros i f.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 186
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exists (f (inhab i)).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 187
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intros; apply path_ishprop.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 188
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 189
Time: 0.002s">
<div class="time" style="width: 0.82304526748971%"></div>
<pre>

  End InhabitedGenerators.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 191
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

End Accessible_Modalities_Theory.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 193
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** We will now show that a modality is accessible in this sense if and only if its underlying reflective subuniverse is accessible in the sense previously defined.  These proofs involve a bit of annoying module wrangling.  Fortunately, we (almost?) never need to actually use them; in practice accessible modalities usually seem to be given to us with the appropriate sort of generators. *)

(** One direction of this implication is trivial. *)</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 197
Time: 0.016s">
<div class="time" style="width: 6.5843621399177%"></div>
<pre>Module Accessible_Modalities_to_ReflectiveSubuniverses
       (Os : Modalities) (Acc : Accessible_Modalities Os).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 198
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Coq won't let us write [&lt;: Accessible_ReflectiveSubuniverses (Modalities_to_ReflectiveSubuniverses Os)]; it says "Application of modules is restricted to paths" (a "path" being something like [Foo.Bar.Baz]).  Thus, every intermediate module has to be given its own name. *)
 </pre>
</div>
<div class="code" title="File: Accessible.v
Line: 201
Time: 0.001s">
<div class="time" style="width: 0.41152263374486%"></div>
<pre>Module Os_RSU := Modalities_to_ReflectiveSubuniverses Os.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 201
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Module AccRSU &lt;: Accessible_ReflectiveSubuniverses Os_RSU.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 202
Time: 0.003s">
<div class="time" style="width: 1.2345679012346%"></div>
<pre>

    Import Os_RSU Acc.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 204
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    Definition acc_gen : ReflectiveSubuniverse@{u a} -&gt; LocalGenerators@{a}
      := fun (O : ReflectiveSubuniverse@{u a}) =&gt;
           (null_to_local_generators (acc_gen O)).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 208
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    Definition inO_iff_islocal@{u a i}
    : forall (O : ReflectiveSubuniverse@{u a}) (X : Type@{i}),
      iff@{i i i}
         (In@{u a i} O X)
         (IsLocal@{i i a} (acc_gen@{u a} O) X)
      := inO_iff_isnull@{u a i}.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 215
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  End AccRSU.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 217
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
End Accessible_Modalities_to_ReflectiveSubuniverses.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 218
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** The converse is less trivial. *)</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 220
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Module Accessible_Modalities_from_ReflectiveSubuniverses
       (Os : Modalities).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 221
Time: 0.001s">
<div class="time" style="width: 0.41152263374486%"></div>
<pre>

  Module Os_RSU := Modalities_to_ReflectiveSubuniverses Os.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 223
Time: 0.004s">
<div class="time" style="width: 1.6460905349794%"></div>
<pre>
  Module AccMod (Acc : Accessible_ReflectiveSubuniverses Os_RSU)
    &lt;: Accessible_Modalities Os.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 225
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    Import Os Acc.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 227
Time: 0.147s">
<div class="time" style="width: 60.493827160494%"></div>
<pre>
    Module Import Os_Theory := Modalities_Theory Os.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 228
Time: 0.073s">
<div class="time" style="width: 30.041152263374%"></div>
<pre>
    Module Import Acc_Theory := Accessible_ReflectiveSubuniverses_Theory Os_RSU Acc.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 229
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** The idea is as follows.  By [ooextendable_isnull_fibers], we can detect locality with respect to a map by nullity with respect to its fibers.  Therefore, our first thought might be to just consider all the fibers of all the maps that we are localizing at.  However, this doesn't quite work because [ooextendable_isnull_fibers] is not an if-and-only-if, so not every modal type would necessarily be null for that type family.

     We do know, however, that if [f] is an [O]-connected map, then any [O]-modal type is null for its fibers (since they are [O]-connected types).  There is no *a priori* why all the maps we localize at should end up being connected for the modality; they will always be inverted, but not every inverted map is connected (unless the modality is lex).  But if [f : A -&gt; B] is [O]-inverted, then the [O]-connected map [to O A] is (up to equivalence) the composite of [f] with the [O]-connected map [to O B].  Thus, if [X] is null for the fibers of [to O A] and [to O B], it will be [f]-local and hence [O]-modal, while all [O]-modal types will be null for these fibers since they are connected. *)

   </pre>
</div>
<div class="code" title="File: Accessible.v
Line: 235
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition acc_gen (O : Modality@{u a}) : NullGenerators@{a}.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 235
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 236
Time: 0.001s">
<div class="time" style="width: 0.41152263374486%"></div>
<pre>
      refine (Build_NullGenerators
                (  { i : lgen_indices@{a} (acc_gen O)
                     &amp; O (lgen_domain@{a} (acc_gen O) i) }
                 + { i : lgen_indices@{a} (acc_gen O)
                     &amp; O (lgen_codomain@{a} (acc_gen O) i) })
                _).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 242
Time: 0.003s">
<div class="time" style="width: 1.2345679012346%"></div>
<pre>
      intros [ [i x] | [i x] ]; exact (hfiber (to O _) x).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 243
Time: 0.002s">
<div class="time" style="width: 0.82304526748971%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 244
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    Definition inO_iff_isnull@{u a i} (O : Modality@{u a}) (X : Type@{i})
    : iff@{i i i} (In@{u a i} O X) (IsNull@{a i} (acc_gen O) X).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 247
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 248
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      pose proof (@conn_map_to_O@{u a a a}).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 249
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      split.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 250
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 251
Time: 0.012s">
<div class="time" style="width: 4.9382716049383%"></div>
<pre> intros X_inO [ [i x] | [i x] ];
          exact (ooextendable_const_isconnected_inO@{u a u a a i i} O _ _).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 252
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          (* MS: annotation can be dropped *)
     </pre>
</div>
<div class="code" title="File: Accessible.v
Line: 254
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>-</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 254
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros Xnull.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 254
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        apply (snd (inO_iff_islocal O X)); intros i.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 255
Time: 0.001s">
<div class="time" style="width: 0.41152263374486%"></div>
<pre>
        refine (cancelL_ooextendable@{a a a i i i i i i}
                  (fun _ =&gt; X) (Acc.acc_gen O i)
                  (to O (lgen_codomain (Acc.acc_gen O) i)) _ _).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 258
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        +</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 259
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply ooextendable_isnull_fibers@{a a i i a a i a a a}; intros x.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 259
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          exact (Xnull (inr (i;x))).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 260
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        +</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 261
Time: 0.002s">
<div class="time" style="width: 0.82304526748971%"></div>
<pre> refine (ooextendable_homotopic _
                   (O_functor O (Acc.acc_gen O i)
                              o to O (lgen_domain (Acc.acc_gen O) i)) _ _).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 263
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          1:apply to_O_natural.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 264
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          apply ooextendable_compose@{a a a i i i i}.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 265
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          *</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 266
Time: 0.001s">
<div class="time" style="width: 0.41152263374486%"></div>
<pre> apply ooextendable_equiv, O_inverts_generators.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 266
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          *</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 267
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply ooextendable_isnull_fibers@{a a i i a a i a a a}; intros x.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 267
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
            exact (Xnull (inl (i;x))).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 268
Time: 0.009s">
<div class="time" style="width: 3.7037037037037%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 269
Time: 0.042s">
<div class="time" style="width: 17.283950617284%"></div>
<pre>

  End AccMod.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 271
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
End Accessible_Modalities_from_ReflectiveSubuniverses.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 272
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** The construction of the nullification modality for any family of types will be in [Nullification]. *)

(** ** Restrictions are accessible *)

</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 277
Time: 0.001s">
<div class="time" style="width: 0.41152263374486%"></div>
<pre>Module Accessible_Restriction_ReflectiveSubuniverses
       (Os : ReflectiveSubuniverses)
       (Acc : Accessible_ReflectiveSubuniverses Os)
       (Res : ReflectiveSubuniverses_Restriction_Data Os).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 280
Time: 0.002s">
<div class="time" style="width: 0.82304526748971%"></div>
<pre>

  Module Import New &lt;: ReflectiveSubuniverses
    := ReflectiveSubuniverses_Restriction Os Res.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 283
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Module Accessible_New &lt;: Accessible_ReflectiveSubuniverses New.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 285
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    Definition acc_gen : New.ReflectiveSubuniverse@{u a} -&gt; LocalGenerators@{a}
      := fun O =&gt; Acc.acc_gen (Res.ReflectiveSubuniverses_restriction O).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 288
Time: 0.001s">
<div class="time" style="width: 0.41152263374486%"></div>
<pre>

    Definition inO_iff_islocal
    : forall (O : New.ReflectiveSubuniverse@{u a}) (X : Type@{i}),
        iff@{i i i}
           (In@{u a i} O X)
           (IsLocal@{i i a} (acc_gen@{u a} O) X)
      := fun O =&gt; Acc.inO_iff_islocal (Res.ReflectiveSubuniverses_restriction O).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 295
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  End Accessible_New.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 297
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

End Accessible_Restriction_ReflectiveSubuniverses.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 299
Time: 0.016s">
<div class="time" style="width: 6.5843621399177%"></div>
<pre>

Module Accessible_Restriction_Modalities
       (Os : Modalities)
       (Acc : Accessible_Modalities Os)
       (Res : Modalities_Restriction_Data Os).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 304
Time: 0.003s">
<div class="time" style="width: 1.2345679012346%"></div>
<pre>

  Module Import New &lt;: Modalities
    := Modalities_Restriction Os Res.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 307
Time: 0.003s">
<div class="time" style="width: 1.2345679012346%"></div>
<pre>

  Module Accessible_New &lt;: Accessible_Modalities New.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 309
Time: 0.149s">
<div class="time" style="width: 61.316872427984%"></div>
<pre>

    Module Import Os_Theory := Modalities_Theory New.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 311
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    Definition acc_gen : New.Modality@{u a} -&gt; NullGenerators@{a}
      := fun O =&gt; Acc.acc_gen (Res.Modalities_restriction O).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 314
Time: 0.001s">
<div class="time" style="width: 0.41152263374486%"></div>
<pre>

    Definition inO_iff_isnull
    : forall (O : New.Modality@{u a}) (X : Type@{i}),
        iff@{i i i}
           (In@{u a i} O X)
           (IsNull@{a i} (acc_gen@{u a} O) X)
      := fun O =&gt; Acc.inO_iff_isnull (Res.Modalities_restriction O).</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 321
Time: 0.052s">
<div class="time" style="width: 21.399176954733%"></div>
<pre>

  End Accessible_New.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 323
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

End Accessible_Restriction_Modalities.</pre>
</div>
<div class="code" title="File: Accessible.v
Line: 326
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

</pre>
</div>
</body>
</html>

