<html>
<head>
<title>Finite.v</title>
<style>
.time {
  background-color: #ffaaaa;
  height: 100%;
  z-index: -1;
  position: absolute;
}
.code {
  z-index: 0;
  position: relative;
  border-style: solid;
  border-color: transparent;
  border-width: 1px;
}
.code:hover {
  border-style: solid;
  border-color: black;
  border-width: 1px;
}
pre {
  margin: 1px;
}
</style>
</head>
<body>
<h1>Timings for Finite.v</h1>

<div class="code" title="File: Finite.v
Line: 1
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>(* -*- mode: coq; mode: visual-line -*- *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1
Time: 0.043s">
<div class="time" style="width: 5.3020961775586%"></div>
<pre>Require Import HoTT.Basics HoTT.Types.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 1
Time: 0.13s">
<div class="time" style="width: 16.029593094945%"></div>
<pre>
Require Import Fibrations Factorization EquivalenceVarieties UnivalenceImpliesFunext HSet HProp DProp.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 2
Time: 0.008s">
<div class="time" style="width: 0.98643649815043%"></div>
<pre>
Require Import HIT.Truncations HIT.quotient.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 3
Time: 0.003s">
<div class="time" style="width: 0.36991368680641%"></div>
<pre>
Import TrM.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 4
Time: 0.003s">
<div class="time" style="width: 0.36991368680641%"></div>
<pre>
Require Import Spaces.Nat.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 5
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Local Open Scope path_scope.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 7
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Local Open Scope nat_scope.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 8
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** * Finite sets *)

(** ** Canonical finite sets *)

(** A *finite set* is a type that is merely equivalent to the canonical finite set determined by some natural number.  There are many equivalent ways to define the canonical finite sets, such as [{ k : nat &amp; k &lt; n}]; we instead choose a recursive one. *)

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 15
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Fixpoint Fin (n : nat) : Type
  := match n with
       | 0 =&gt; Empty
       | S n =&gt; Fin n + Unit
     end.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 19
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Global Instance decidable_fin (n : nat)
: Decidable (Fin n).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 22
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 23
Time: 0.05s">
<div class="time" style="width: 6.1652281134402%"></div>
<pre>
  destruct n as [|n]; try exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 24
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  exact (inl (inr tt)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 25
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 26
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Global Instance decidablepaths_fin (n : nat)
: DecidablePaths (Fin n).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 29
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 30
Time: 0.08s">
<div class="time" style="width: 9.8643649815043%"></div>
<pre>
  induction n as [|n IHn]; simpl; exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 31
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 32
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Global Instance contr_fin1 : Contr (Fin 1).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 34
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 35
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  refine (contr_equiv' Unit (sum_empty_l Unit)^-1).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 36
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 37
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition fin_empty (n : nat) (f : Fin n -&gt; Empty) : n = 0.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 39
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 40
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
  destruct n; [ reflexivity | ].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 41
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  elim (f (inr tt)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 42
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 43
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Transposition equivalences *)

(** To prove some basic facts about canonical finite sets, we need some standard automorphisms of them.  Here we define some transpositions and prove that they in fact do the desired things. *)

(** *** Swap the last two elements. *)

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 50
Time: 0.004s">
<div class="time" style="width: 0.49321824907522%"></div>
<pre>Definition fin_transpose_last_two (n : nat)
: Fin n.+2 &lt;~&gt; Fin n.+2
  := ((equiv_sum_assoc _ _ _)^-1)
       oE (1 +E (equiv_sum_symm _ _))
       oE (equiv_sum_assoc _ _ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 54
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Arguments fin_transpose_last_two : simpl nomatch.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 56
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>

Definition fin_transpose_last_two_last (n : nat)
: fin_transpose_last_two n (inr tt) = (inl (inr tt))
  := 1.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 60
Time: 0.003s">
<div class="time" style="width: 0.36991368680641%"></div>
<pre>

Definition fin_transpose_last_two_nextlast (n : nat)
: fin_transpose_last_two n (inl (inr tt)) = (inr tt)
  := 1.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 64
Time: 0.003s">
<div class="time" style="width: 0.36991368680641%"></div>
<pre>

Definition fin_transpose_last_two_rest (n : nat) (k : Fin n)
: fin_transpose_last_two n (inl (inl k)) = (inl (inl k))
  := 1.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 68
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** *** Swap the last element with [k]. *)

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 71
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Fixpoint fin_transpose_last_with (n : nat) (k : Fin n.+1)
: Fin n.+1 &lt;~&gt; Fin n.+1.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 72
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 73
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
  destruct k as [k|].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 74
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 75
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> destruct n as [|n IH].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 75
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 76
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> elim k.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 76
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 77
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre> destruct k as [k|].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 77
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 78
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> refine ((fin_transpose_last_two n)
                  oE _
                  oE (fin_transpose_last_two n)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 80
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
        refine ((fin_transpose_last_with n (inl k)) +E 1).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 81
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 82
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply fin_transpose_last_two.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 82
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 83
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (equiv_idmap _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 83
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 84
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Arguments fin_transpose_last_with : simpl nomatch.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 86
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition fin_transpose_last_with_last (n : nat) (k : Fin n.+1)
: fin_transpose_last_with n k (inr tt) = k.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 89
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 90
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
  destruct k as [k|].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 91
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 92
Time: 0.005s">
<div class="time" style="width: 0.61652281134402%"></div>
<pre> induction n as [|n IH]; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 92
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 93
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> elim k.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 93
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 94
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre> destruct k as [k|].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 94
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 95
Time: 0.132s">
<div class="time" style="width: 16.276202219482%"></div>
<pre> simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 95
Time: 0.049s">
<div class="time" style="width: 6.0419235511714%"></div>
<pre> rewrite IH; reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 95
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 96
Time: 0.018s">
<div class="time" style="width: 2.2194821208385%"></div>
<pre> simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 96
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre> apply ap, ap, path_contr.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 96
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 97
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> (** We have to destruct [n] since fixpoints don't reduce unless their argument is a constructor. *)
   </pre>
</div>
<div class="code" title="File: Finite.v
Line: 98
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>destruct n; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 98
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
    all:apply ap, path_contr.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 99
Time: 0.009s">
<div class="time" style="width: 1.1097410604192%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 100
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition fin_transpose_last_with_with (n : nat) (k : Fin n.+1)
: fin_transpose_last_with n k k = inr tt.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 103
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 104
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
  destruct k as [k|].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 105
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 106
Time: 0.004s">
<div class="time" style="width: 0.49321824907522%"></div>
<pre> induction n as [|n IH]; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 106
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 107
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> elim k.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 107
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 108
Time: 0.142s">
<div class="time" style="width: 17.50924784217%"></div>
<pre> destruct k as [|k]; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 108
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 109
Time: 0.003s">
<div class="time" style="width: 0.36991368680641%"></div>
<pre> rewrite IH; reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 109
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 110
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply ap, path_contr.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 110
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 111
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre> destruct n; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 111
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
    all:apply ap, path_contr.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 112
Time: 0.009s">
<div class="time" style="width: 1.1097410604192%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 113
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>

Definition fin_transpose_last_with_rest (n : nat)
           (k : Fin n.+1) (l : Fin n)
           (notk : k &lt;&gt; inl l)
: fin_transpose_last_with n k (inl l) = (inl l).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 118
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 119
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>
  destruct k as [k|].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 120
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 121
Time: 0.005s">
<div class="time" style="width: 0.61652281134402%"></div>
<pre> induction n as [|n IH]; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 121
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    1:elim k.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 122
Time: 0.31s">
<div class="time" style="width: 38.224414303329%"></div>
<pre>
    destruct k as [k|]; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 123
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 124
Time: 0.011s">
<div class="time" style="width: 1.3563501849568%"></div>
<pre> destruct l as [l|]; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 124
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 125
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre> rewrite IH.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 125
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 126
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 126
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 127
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre> exact (fun p =&gt; notk (ap inl p)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 127
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 128
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 128
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 128
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 129
Time: 0.006s">
<div class="time" style="width: 0.73982737361282%"></div>
<pre> destruct l as [l|]; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 129
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 130
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 130
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 131
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre> elim (notk (ap inl (ap inr (path_unit _ _)))).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 131
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 131
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 132
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre> destruct n; reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 132
Time: 0.03s">
<div class="time" style="width: 3.6991368680641%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 133
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition fin_transpose_last_with_last_other (n : nat) (k : Fin n.+1)
: fin_transpose_last_with n (inr tt) k = k.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 136
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 137
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
  destruct n; reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 138
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 139
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>

Definition fin_transpose_last_with_invol (n : nat) (k : Fin n.+1)
: fin_transpose_last_with n k o fin_transpose_last_with n k == idmap.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 142
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 143
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros l.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 144
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
  destruct l as [l|[]].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 145
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 146
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre> destruct k as [k|[]].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 146
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 147
Time: 0.003s">
<div class="time" style="width: 0.36991368680641%"></div>
<pre> destruct (dec_paths k l) as [p|p].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 147
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 148
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> rewrite p.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 148
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
        rewrite fin_transpose_last_with_with.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 149
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        apply fin_transpose_last_with_last.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 150
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 151
Time: 0.003s">
<div class="time" style="width: 0.36991368680641%"></div>
<pre> rewrite fin_transpose_last_with_rest;
          try apply fin_transpose_last_with_rest;
          exact (fun q =&gt; p (path_sum_inl _ q)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 153
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 153
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 154
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre> rewrite fin_transpose_last_with_last_other.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 154
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply fin_transpose_last_with_last_other.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 155
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 156
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre> rewrite fin_transpose_last_with_last.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 156
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply fin_transpose_last_with_with.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 157
Time: 0.006s">
<div class="time" style="width: 0.73982737361282%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 158
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Equivalences between canonical finite sets *)

(** To give an equivalence [Fin n.+1 &lt;~&gt; Fin m.+1] is equivalent to giving an element of [Fin m.+1] (the image of the last element) together with an equivalence [Fin n &lt;~&gt; Fin m].  More specifically, any such equivalence can be decomposed uniquely as a last-element transposition followed by an equivalence fixing the last element.  *)

(** Here is the uncurried map that constructs an equivalence [Fin n.+1 &lt;~&gt; Fin m.+1]. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 164
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>Definition fin_equiv (n m : nat)
           (k : Fin m.+1) (e : Fin n &lt;~&gt; Fin m)
: Fin n.+1 &lt;~&gt; Fin m.+1
  := (fin_transpose_last_with m k)
       oE (e +E 1).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 168
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Here is the curried version that we will prove to be an equivalence. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 170
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>Definition fin_equiv' (n m : nat)
: ((Fin m.+1) * (Fin n &lt;~&gt; Fin m)) -&gt; (Fin n.+1 &lt;~&gt; Fin m.+1)
  := fun ke =&gt; fin_equiv n m (fst ke) (snd ke).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 172
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** We construct its inverse and the two homotopies first as versions using homotopies without funext (similar to [ExtendableAlong]), then apply funext at the end. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 174
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>Definition fin_equiv_hfiber (n m : nat) (e : Fin n.+1 &lt;~&gt; Fin m.+1)
: { kf : (Fin m.+1) * (Fin n &lt;~&gt; Fin m) &amp; fin_equiv' n m kf == e }.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 175
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 176
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  simpl in e.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 177
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
  refine (equiv_sigma_prod _ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 178
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  recall (e (inr tt)) as y eqn:p.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 179
Time: 0.007s">
<div class="time" style="width: 0.86313193588163%"></div>
<pre>
  assert (p' := (moveL_equiv_V _ _ p)^).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 180
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  exists y.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 181
Time: 0.003s">
<div class="time" style="width: 0.36991368680641%"></div>
<pre>
  destruct y as [y|[]].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 182
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 183
Time: 0.008s">
<div class="time" style="width: 0.98643649815043%"></div>
<pre> simple refine (equiv_unfunctor_sum_l
              (fin_transpose_last_with m (inl y) oE e)
              _ _ ; _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 185
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 186
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros a.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 186
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre> ev_equiv.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 186
Time: 0.011s">
<div class="time" style="width: 1.3563501849568%"></div>
<pre>
      assert (q : inl y &lt;&gt; e (inl a))
        by exact (fun z =&gt; inl_ne_inr _ _ (equiv_inj e (z^ @ p^))).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 188
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
      set (z := e (inl a)) in *.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 189
Time: 0.003s">
<div class="time" style="width: 0.36991368680641%"></div>
<pre>
      destruct z as [z|[]].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 190
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 191
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre> rewrite fin_transpose_last_with_rest;
        try exact tt; try assumption.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 192
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 193
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre> rewrite fin_transpose_last_with_last; exact tt.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 193
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 193
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 194
Time: 0.01s">
<div class="time" style="width: 1.233045622688%"></div>
<pre> intros [].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 194
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre> ev_equiv.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 194
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
      rewrite p.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 195
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
      rewrite fin_transpose_last_with_with; exact tt.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 196
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 196
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>
    intros x.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 197
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre> unfold fst, snd; ev_equiv.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 197
Time: 0.08s">
<div class="time" style="width: 9.8643649815043%"></div>
<pre> simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 197
Time: 0.052s">
<div class="time" style="width: 6.4118372379778%"></div>
<pre>
    destruct x as [x|[]]; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 198
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 199
Time: 0.006s">
<div class="time" style="width: 0.73982737361282%"></div>
<pre> rewrite unfunctor_sum_l_beta.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 199
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
      apply fin_transpose_last_with_invol.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 200
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 201
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre> refine (fin_transpose_last_with_last _ _ @ p^).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 201
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 202
Time: 0.003s">
<div class="time" style="width: 0.36991368680641%"></div>
<pre> simple refine (equiv_unfunctor_sum_l e _ _ ; _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 202
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 203
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros a.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 203
Time: 0.003s">
<div class="time" style="width: 0.36991368680641%"></div>
<pre>
      destruct (is_inl_or_is_inr (e (inl a))) as [l|r].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 204
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 205
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact l.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 205
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 206
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> assert (q := inr_un_inr (e (inl a)) r).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 206
Time: 0.009s">
<div class="time" style="width: 1.1097410604192%"></div>
<pre>
        apply moveR_equiv_V in q.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 207
Time: 0.003s">
<div class="time" style="width: 0.36991368680641%"></div>
<pre>
        assert (s := q^ @ ap (e^-1 o inr) (path_unit _ _) @ p').</pre>
</div>
<div class="code" title="File: Finite.v
Line: 208
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        elim (inl_ne_inr _ _ s).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 209
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 209
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 210
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre> intros []; exact (p^ # tt).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 210
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 210
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>
    intros x.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 211
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre> unfold fst, snd; ev_equiv.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 211
Time: 0.014s">
<div class="time" style="width: 1.7262638717633%"></div>
<pre> simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 211
Time: 0.009s">
<div class="time" style="width: 1.1097410604192%"></div>
<pre>
    destruct x as [a|[]].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 212
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 213
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre> rewrite fin_transpose_last_with_last_other.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 213
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
      apply unfunctor_sum_l_beta.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 214
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 215
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 215
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
      rewrite fin_transpose_last_with_last.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 216
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
      symmetry; apply p.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 217
Time: 0.126s">
<div class="time" style="width: 15.536374845869%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 218
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>

Definition fin_equiv_inv (n m : nat) (e : Fin n.+1 &lt;~&gt; Fin m.+1)
: (Fin m.+1) * (Fin n &lt;~&gt; Fin m)
  := (fin_equiv_hfiber n m e).1.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 222
Time: 0.003s">
<div class="time" style="width: 0.36991368680641%"></div>
<pre>

Definition fin_equiv_issect (n m : nat) (e : Fin n.+1 &lt;~&gt; Fin m.+1)
: fin_equiv' n m (fin_equiv_inv n m e) == e
  := (fin_equiv_hfiber n m e).2.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 226
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>

Definition fin_equiv_inj_fst (n m : nat)
           (k l : Fin m.+1) (e f : Fin n &lt;~&gt; Fin m)
: (fin_equiv n m k e == fin_equiv n m l f) -&gt; (k = l).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 230
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 231
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros p.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 232
Time: 0.005s">
<div class="time" style="width: 0.61652281134402%"></div>
<pre>
  refine (_ @ p (inr tt) @ _); simpl;
  rewrite fin_transpose_last_with_last; reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 234
Time: 0.003s">
<div class="time" style="width: 0.36991368680641%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 235
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>

Definition fin_equiv_inj_snd (n m : nat)
           (k l : Fin m.+1) (e f : Fin n &lt;~&gt; Fin m)
: (fin_equiv n m k e == fin_equiv n m l f) -&gt; (e == f).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 239
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 240
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros p.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 241
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros x.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 242
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre> assert (q := p (inr tt)); simpl in q.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 242
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>
  rewrite !fin_transpose_last_with_last in q.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 243
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  rewrite &lt;- q in p; clear q l.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 244
Time: 0.019s">
<div class="time" style="width: 2.3427866831073%"></div>
<pre>
  exact (path_sum_inl _
           (equiv_inj (fin_transpose_last_with m k) (p (inl x)))).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 246
Time: 0.004s">
<div class="time" style="width: 0.49321824907522%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 247
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Now it's time for funext. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 249
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance isequiv_fin_equiv `{Funext} (n m : nat)
: IsEquiv (fin_equiv' n m).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 250
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 251
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
  refine (isequiv_pathsplit 0 _); split.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 252
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 253
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros e; exists (fin_equiv_inv n m e).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 253
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>
    apply path_equiv, path_arrow, fin_equiv_issect.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 254
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 255
Time: 0.004s">
<div class="time" style="width: 0.49321824907522%"></div>
<pre> intros [k e] [l f]; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 255
Time: 0.008s">
<div class="time" style="width: 0.98643649815043%"></div>
<pre>
    refine (_ , fun _ _ =&gt; tt).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 256
Time: 0.092s">
<div class="time" style="width: 11.34401972873%"></div>
<pre>
    intros p; refine (_ ; path_ishprop _ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 257
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
    apply (ap equiv_fun) in p.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 258
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply ap10 in p.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 259
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply path_prod'.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 260
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 261
Time: 0.004s">
<div class="time" style="width: 0.49321824907522%"></div>
<pre> refine (fin_equiv_inj_fst n m k l e f p).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 261
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 262
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre> apply path_equiv, path_arrow.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 262
Time: 0.004s">
<div class="time" style="width: 0.49321824907522%"></div>
<pre>
      refine (fin_equiv_inj_snd n m k l e f p).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 263
Time: 0.027s">
<div class="time" style="width: 3.3292231812577%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 264
Time: 0.014s">
<div class="time" style="width: 1.7262638717633%"></div>
<pre>

Definition equiv_fin_equiv `{Funext} (n m : nat)
: ((Fin m.+1) * (Fin n &lt;~&gt; Fin m)) &lt;~&gt; (Fin n.+1 &lt;~&gt; Fin m.+1)
  := BuildEquiv _ _ (fin_equiv' n m) _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 268
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** In particular, this implies that if two canonical finite sets are equivalent, then their cardinalities are equal. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 270
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition nat_eq_fin_equiv (n m : nat)
: (Fin n &lt;~&gt; Fin m) -&gt; (n = m).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 271
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 272
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
  revert m; induction n as [|n IHn]; induction m as [|m IHm]; intros e.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 273
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 274
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact idpath.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 274
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 275
Time: 0.014s">
<div class="time" style="width: 1.7262638717633%"></div>
<pre> elim (e^-1 (inr tt)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 275
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 276
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> elim (e (inr tt)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 276
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 277
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> refine (ap S (IHn m _)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 277
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact (snd (fin_equiv_inv n m e)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 278
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 279
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Definition of general finite sets *)

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 282
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>Class Finite (X : Type) :=
  { fcard : nat ;
    merely_equiv_fin : merely (X &lt;~&gt; Fin fcard) }.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 284
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Arguments fcard X {_}.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 286
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Arguments merely_equiv_fin X {_}.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 287
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition issig_finite X
: { n : nat &amp; merely (X &lt;~&gt; Fin n) } &lt;~&gt; Finite X.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 290
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 291
Time: 0.006s">
<div class="time" style="width: 0.73982737361282%"></div>
<pre>
  issig (@Build_Finite X) (@fcard X) (@merely_equiv_fin X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 292
Time: 0.003s">
<div class="time" style="width: 0.36991368680641%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 293
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Note that the sigma over cardinalities is not truncated.  Nevertheless, because canonical finite sets of different cardinalities are not isomorphic, being finite is still an hprop.  (Thus, we could have truncated the sigma and gotten an equivalent definition, but it would be less convenient to reason about.) *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 295
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance ishprop_finite X
: IsHProp (Finite X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 296
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 297
Time: 0.07s">
<div class="time" style="width: 8.6313193588163%"></div>
<pre>
  refine (trunc_equiv' _ (issig_finite X)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 298
Time: 0.007s">
<div class="time" style="width: 0.86313193588163%"></div>
<pre>
  apply ishprop_sigma_disjoint; intros n m Hn Hm.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 299
Time: 0.095s">
<div class="time" style="width: 11.713933415536%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 300
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  refine (nat_eq_fin_equiv n m (Hm oE Hn^-1)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 301
Time: 0.003s">
<div class="time" style="width: 0.36991368680641%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 302
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Preservation of finiteness by equivalences *)

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 305
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition finite_equiv X {Y} (e : X -&gt; Y) `{IsEquiv X Y e}
: Finite X -&gt; Finite Y.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 306
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 307
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros ?.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 308
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  refine (Build_Finite Y (fcard X) _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 309
Time: 0.042s">
<div class="time" style="width: 5.1787916152898%"></div>
<pre>
  assert (f := merely_equiv_fin X); strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 310
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  apply tr.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 311
Time: 0.013s">
<div class="time" style="width: 1.6029593094945%"></div>
<pre>
  exact (equiv_compose f e^-1).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 312
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 313
Time: 0.005s">
<div class="time" style="width: 0.61652281134402%"></div>
<pre>

Definition finite_equiv' X {Y} (e : X &lt;~&gt; Y)
: Finite X -&gt; Finite Y
  := finite_equiv X e.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 317
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Corollary finite_equiv_equiv X Y
: (X &lt;~&gt; Y) -&gt; (Finite X &lt;~&gt; Finite Y).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 320
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 321
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>
  intros ?; apply equiv_iff_hprop; apply finite_equiv';
    [ assumption | symmetry; assumption ].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 323
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 324
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>

Definition fcard_equiv {X Y} (e : X -&gt; Y) `{IsEquiv X Y e}
           `{Finite X} `{Finite Y}
: fcard X = fcard Y.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 328
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 329
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
  transitivity (@fcard Y (finite_equiv X e _)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 330
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 331
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 331
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 332
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre> exact (ap (@fcard Y) (path_ishprop _ _)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 332
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 333
Time: 0.009s">
<div class="time" style="width: 1.1097410604192%"></div>
<pre>

Definition fcard_equiv' {X Y} (e : X &lt;~&gt; Y)
           `{Finite X} `{Finite Y}
: fcard X = fcard Y
  := fcard_equiv e.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 338
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Simple examples of finite sets *)

(** Canonical finite sets are finite *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 342
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>Global Instance finite_fin n : Finite (Fin n)
  := Build_Finite _ n (tr (equiv_idmap _)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 343
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** This includes the empty set. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 345
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance finite_empty : Finite Empty
  := finite_fin 0.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 346
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** The unit type is finite, since it's equivalent to [Fin 1]. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 348
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance finite_unit : Finite Unit.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 348
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 349
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  refine (finite_equiv' (Fin 1) _ _); simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 350
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  apply sum_empty_l.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 351
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 352
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Thus, any contractible type is finite. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 354
Time: 0.01s">
<div class="time" style="width: 1.233045622688%"></div>
<pre>Global Instance finite_contr X `{Contr X} : Finite X
  := finite_equiv Unit equiv_contr_unit^-1 _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 355
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Any decidable hprop is finite, since it must be equivalent to [Empty] or [Unit]. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 357
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition finite_decidable_hprop X `{IsHProp X} `{Decidable X}
: Finite X.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 358
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 359
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
  destruct (dec X) as [x|nx].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 360
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 361
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> assert (Contr X) by exact (contr_inhabited_hprop X x).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 361
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 362
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 363
Time: 0.01s">
<div class="time" style="width: 1.233045622688%"></div>
<pre> refine (finite_equiv Empty nx^-1 _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 363
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 364
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Hint Immediate finite_decidable_hprop : typeclass_instances.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 366
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** It follows that the propositional truncation of any finite set is finite. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 368
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance finite_merely X {fX : Finite X}
: Finite (merely X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 369
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 370
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  (** As in decidable_finite_hprop, we case on cardinality first to avoid needing funext. *)
 </pre>
</div>
<div class="code" title="File: Finite.v
Line: 372
Time: 0.099s">
<div class="time" style="width: 12.207151664612%"></div>
<pre>destruct fX as [[|n] e]; refine (finite_decidable_hprop _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 372
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 373
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> right.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 373
Time: 0.05s">
<div class="time" style="width: 6.1652281134402%"></div>
<pre>
    intros x; strip_truncations; exact (e x).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 374
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 375
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> left.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 375
Time: 0.031s">
<div class="time" style="width: 3.8224414303329%"></div>
<pre>
    strip_truncations; exact (tr (e^-1 (inr tt))).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 376
Time: 0.003s">
<div class="time" style="width: 0.36991368680641%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 377
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Finite sets are closed under path-spaces. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 379
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance finite_paths {X} `{Finite X} (x y : X)
: Finite (x = y).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 380
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 381
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  (** If we assume [Funext], then typeclass inference produces this automatically, since [X] has decidable equality and (hence) is a set, so [x=y] is a decidable hprop.  But we can also deduce it without funext, since [Finite] is an hprop even without funext. *)
 </pre>
</div>
<div class="code" title="File: Finite.v
Line: 383
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>assert (e := merely_equiv_fin X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 383
Time: 0.051s">
<div class="time" style="width: 6.288532675709%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 384
Time: 0.194s">
<div class="time" style="width: 23.921085080148%"></div>
<pre>
  refine (finite_equiv _ (ap e)^-1 _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 385
Time: 0.113s">
<div class="time" style="width: 13.933415536375%"></div>
<pre>
  apply finite_decidable_hprop; exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 386
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 387
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Finite sets are also closed under successors. *)

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 390
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance finite_succ X `{Finite X} : Finite (X + Unit).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 390
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 391
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  refine (Build_Finite _ (fcard X).+1 _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 392
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  pose proof (merely_equiv_fin X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 393
Time: 0.024s">
<div class="time" style="width: 2.9593094944513%"></div>
<pre>
  strip_truncations; apply tr.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 394
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  refine (_ +E 1); assumption.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 395
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 396
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>

Definition fcard_succ X `{Finite X}
: fcard (X + Unit) = (fcard X).+1
  := 1.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 400
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Decidability *)

(** Like canonical finite sets, finite sets have decidable equality. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 404
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance decidablepaths_finite `{Funext} X `{Finite X}
: DecidablePaths X.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 405
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 406
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (e := merely_equiv_fin X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 407
Time: 0.037s">
<div class="time" style="width: 4.5622688039457%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 408
Time: 0.013s">
<div class="time" style="width: 1.6029593094945%"></div>
<pre>
  refine (decidablepaths_equiv _ e^-1 _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 409
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 410
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** However, contrary to what you might expect, we cannot assert that "every finite set is decidable"!  That would be claiming a *uniform* way to select an element from every nonempty finite set, which contradicts univalence. *)

(** One thing we can prove is that any finite hprop is decidable. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 414
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance decidable_finite_hprop X `{IsHProp X} {fX : Finite X}
: Decidable X.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 415
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 416
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  (** To avoid having to use [Funext], we case on the cardinality of [X] before stripping the truncation from its equivalence to [Fin n]; if we did things in the other order then we'd have to know that [Decidable X] is an hprop, which requires funext. *)
 </pre>
</div>
<div class="code" title="File: Finite.v
Line: 418
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>destruct fX as [[|n] e].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 418
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 419
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> right; intros x.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 419
Time: 0.058s">
<div class="time" style="width: 7.1516646115906%"></div>
<pre>
    strip_truncations; exact (e x).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 420
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 421
Time: 0.004s">
<div class="time" style="width: 0.49321824907522%"></div>
<pre> left.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 421
Time: 0.039s">
<div class="time" style="width: 4.8088779284834%"></div>
<pre>
    strip_truncations; exact (e^-1 (inr tt)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 422
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 423
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** It follows that if [X] is finite, then its propositional truncation is decidable. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 425
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance decidable_merely_finite X {fX : Finite X}
: Decidable (merely X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 426
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 427
Time: 0.032s">
<div class="time" style="width: 3.9457459926017%"></div>
<pre>
  exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 428
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 429
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** From this, it follows that any finite set is *merely* decidable. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 431
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition merely_decidable_finite X `{Finite X}
: merely (Decidable X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 432
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 433
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
  apply O_decidable; exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 434
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 435
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Induction over finite sets *)

(** Most concrete applications of this don't actually require univalence, but the general version does.  For this reason the general statement is less useful (and less used in the sequel) than it might be. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 439
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>Definition finite_ind_hprop `{Univalence}
           (P : forall X, Finite X -&gt; Type)
           `{forall X (fX:Finite X), IsHProp (P X _)}
           (f0 : P Empty _)
           (fs : forall X (fX:Finite X), P X _ -&gt; P (X + Unit)%type _)
           (X : Type) `{Finite X}
: P X _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 445
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 446
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (e := merely_equiv_fin X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 447
Time: 0.089s">
<div class="time" style="width: 10.974106041924%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 448
Time: 0.015s">
<div class="time" style="width: 1.8495684340321%"></div>
<pre>
  assert (p := transportD Finite P (path_universe e^-1) _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 449
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
  refine (transport (P X) (path_ishprop _ _) (p _)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 450
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  generalize (fcard X); intros n.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 451
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  induction n as [|n IH].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 452
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 453
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact f0.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 453
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 454
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre> refine (transport (P (Fin n.+1)) (path_ishprop _ _) (fs _ _ IH)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 454
Time: 0.003s">
<div class="time" style="width: 0.36991368680641%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 455
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** The finite axiom of choice *)

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 458
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition finite_choice {X} `{Finite X} (P : X -&gt; Type)
: (forall x, merely (P x)) -&gt; merely (forall x, P x).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 459
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 460
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros f.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 461
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (e := merely_equiv_fin X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 462
Time: 0.041s">
<div class="time" style="width: 5.055487053021%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 463
Time: 0.009s">
<div class="time" style="width: 1.1097410604192%"></div>
<pre>
  set (P' := P o e^-1).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 464
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (f' := (fun x =&gt; f (e^-1 x)) : forall x, merely (P' x)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 465
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
  refine (Trunc_functor (X := forall x:Fin (fcard X), P' x) -1 _ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 466
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 467
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros g x; exact (eissect e x # g (e x)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 467
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 468
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> clearbody P'; clear f P e.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 468
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    generalize dependent (fcard X); intros n P f.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 469
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    induction n as [|n IH].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 470
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 471
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (tr (Empty_ind P)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 471
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 472
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre> specialize (IH (P o inl) (f o inl)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 472
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      assert (e := f (inr tt)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 473
Time: 0.144s">
<div class="time" style="width: 17.755856966708%"></div>
<pre>
      strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 474
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact (tr (sum_ind P IH (Unit_ind e))).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 475
Time: 0.007s">
<div class="time" style="width: 0.86313193588163%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 476
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Constructions on finite sets *)

(** Finite sets are closed under sums, products, function spaces, and equivalence spaces.  There are multiple choices we could make regarding how to prove these facts.  Since we know what the cardinalities ought to be in all cases (since we know how to add, multiply, exponentiate, and take factorials of natural numbers), we could specify those off the bat, and then reduce to the case of canonical finite sets.  However, it's more amusing to instead prove finiteness of these constructions by "finite-set induction", and then *deduce* that their cardinalities are given by the corresponding operations on natural numbers (because they satisfy the same recurrences). *)

(** *** Binary sums *)

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 483
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance finite_sum X Y `{Finite X} `{Finite Y}
: Finite (X + Y).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 484
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 485
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (e := merely_equiv_fin Y).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 486
Time: 0.042s">
<div class="time" style="width: 5.1787916152898%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 487
Time: 0.06s">
<div class="time" style="width: 7.3982737361282%"></div>
<pre>
  refine (finite_equiv _ (functor_sum idmap e^-1) _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 488
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  generalize (fcard Y); intros n.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 489
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  induction n as [|n IH].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 490
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 491
Time: 0.025s">
<div class="time" style="width: 3.0826140567201%"></div>
<pre> refine (finite_equiv _ (sum_empty_r X)^-1 _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 491
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 492
Time: 0.029s">
<div class="time" style="width: 3.5758323057953%"></div>
<pre> refine (finite_equiv _ (equiv_sum_assoc X _ Unit) _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 492
Time: 0.003s">
<div class="time" style="width: 0.36991368680641%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 493
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Note that the cardinality function [fcard] actually computes.  The same will be true of all the other proofs in this section, though we don't always verify it. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 495
Time: 0.016s">
<div class="time" style="width: 1.9728729963009%"></div>
<pre>Goal fcard (Fin 3 + Fin 4) = 7.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 495
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 496
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Abort.

Definition fcard_sum X Y `{Finite X} `{Finite Y}
: fcard (X + Y) = (fcard X + fcard Y).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 500
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 500
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  refine (_ @ nat_plus_comm _ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 501
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (e := merely_equiv_fin Y).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 502
Time: 0.081s">
<div class="time" style="width: 9.9876695437731%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 503
Time: 0.021s">
<div class="time" style="width: 2.5893958076449%"></div>
<pre>
  refine (fcard_equiv' (1 +E e) @ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 504
Time: 0.023s">
<div class="time" style="width: 2.8360049321825%"></div>
<pre>
  refine (_ @ ap (fun y =&gt; (y + fcard X)) (fcard_equiv e^-1)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 505
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  generalize (fcard Y); intros n.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 506
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  induction n as [|n IH].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 507
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 508
Time: 0.054s">
<div class="time" style="width: 6.6584463625154%"></div>
<pre> refine (fcard_equiv (sum_empty_r X)^-1).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 508
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 509
Time: 0.124s">
<div class="time" style="width: 15.289765721332%"></div>
<pre> refine (fcard_equiv (equiv_sum_assoc _ _ _)^-1 @ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 509
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
    exact (ap S IH).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 510
Time: 0.008s">
<div class="time" style="width: 0.98643649815043%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 511
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** *** Binary products *)

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 514
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance finite_prod X Y `{Finite X} `{Finite Y}
: Finite (X * Y).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 515
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 516
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (e := merely_equiv_fin Y).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 517
Time: 0.043s">
<div class="time" style="width: 5.3020961775586%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 518
Time: 0.081s">
<div class="time" style="width: 9.9876695437731%"></div>
<pre>
  refine (finite_equiv _ (functor_prod idmap e^-1) _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 519
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  generalize (fcard Y); intros n.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 520
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  induction n as [|n IH].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 521
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 522
Time: 0.018s">
<div class="time" style="width: 2.2194821208385%"></div>
<pre> refine (finite_equiv _ (prod_empty_r X)^-1 _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 522
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 523
Time: 0.067s">
<div class="time" style="width: 8.2614056720099%"></div>
<pre> refine (finite_equiv _ (sum_distrib_l X _ Unit)^-1 (finite_sum _ _)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 523
Time: 0.021s">
<div class="time" style="width: 2.5893958076449%"></div>
<pre>
    refine (finite_equiv _ (prod_unit_r X)^-1 _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 524
Time: 0.004s">
<div class="time" style="width: 0.49321824907522%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 525
Time: 0.029s">
<div class="time" style="width: 3.5758323057953%"></div>
<pre>

Definition fcard_prod X Y `{Finite X} `{Finite Y}
: fcard (X * Y) = fcard X * fcard Y.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 528
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 529
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (e := merely_equiv_fin X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 530
Time: 0.083s">
<div class="time" style="width: 10.234278668311%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 531
Time: 0.053s">
<div class="time" style="width: 6.5351418002466%"></div>
<pre>
  refine (fcard_equiv' (e *E 1) @ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 532
Time: 0.026s">
<div class="time" style="width: 3.2059186189889%"></div>
<pre>
  refine (_ @ ap (fun x =&gt; x * fcard Y) (fcard_equiv e^-1)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 533
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  generalize (fcard X); intros n.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 534
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  induction n as [|n IH].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 535
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 536
Time: 0.061s">
<div class="time" style="width: 7.521578298397%"></div>
<pre> refine (fcard_equiv (prod_empty_l Y)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 536
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 537
Time: 0.211s">
<div class="time" style="width: 26.017262638718%"></div>
<pre> refine (fcard_equiv (sum_distrib_r Y (Fin n) Unit) @ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 537
Time: 0.005s">
<div class="time" style="width: 0.61652281134402%"></div>
<pre>
    refine (fcard_sum _ _ @ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 538
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
    simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 539
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
    refine (_ @ nat_plus_comm _ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 540
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>
    refine (ap011 plus _ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 541
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 542
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre> apply IH.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 542
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 543
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre> apply fcard_equiv', prod_unit_l.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 543
Time: 0.022s">
<div class="time" style="width: 2.7127003699137%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 544
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** *** Function types *)

(** Finite sets are closed under function types, and even dependent function types. *)

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 549
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Global Instance finite_forall `{Funext} {X} (Y : X -&gt; Type)
       `{Finite X} `{forall x, Finite (Y x)}
: Finite (forall x:X, Y x).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 551
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 552
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (e := merely_equiv_fin X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 553
Time: 0.058s">
<div class="time" style="width: 7.1516646115906%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 554
Time: 0.272s">
<div class="time" style="width: 33.538840937115%"></div>
<pre>
  simple refine (finite_equiv' _
            (equiv_functor_forall' (P := fun x =&gt; Y (e^-1 x)) e _) _); try exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 556
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 557
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre> intros x; refine (equiv_transport _ _ _ (eissect e x)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 557
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 557
Time: 0.012s">
<div class="time" style="width: 1.4796547472256%"></div>
<pre>
  set (Y' := Y o e^-1); change (Finite (forall x, Y' x)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 558
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
  assert (forall x, Finite (Y' x)) by exact _; clearbody Y'; clear e.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 559
Time: 0.009s">
<div class="time" style="width: 1.1097410604192%"></div>
<pre>
  generalize dependent (fcard X); intros n Y' ?.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 560
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  induction n as [|n IH].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 561
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 562
Time: 0.013s">
<div class="time" style="width: 1.6029593094945%"></div>
<pre> exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 562
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 563
Time: 0.176s">
<div class="time" style="width: 21.701602959309%"></div>
<pre> refine (finite_equiv _ (equiv_sum_ind Y') _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 563
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
    apply finite_prod.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 564
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 565
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre> apply IH; exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 565
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 566
Time: 0.06s">
<div class="time" style="width: 7.3982737361282%"></div>
<pre> refine (finite_equiv _ (@Unit_ind (fun u =&gt; Y' (inr u))) _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 566
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
      refine (isequiv_unit_ind (Y' o inr)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 567
Time: 0.007s">
<div class="time" style="width: 0.86313193588163%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 568
Time: 0.044s">
<div class="time" style="width: 5.4254007398274%"></div>
<pre>

Definition fcard_arrow `{Funext} X Y `{Finite X} `{Finite Y}
: fcard (X -&gt; Y) = nat_exp (fcard Y) (fcard X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 571
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 572
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (e := merely_equiv_fin X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 573
Time: 0.114s">
<div class="time" style="width: 14.056720098644%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 574
Time: 0.129s">
<div class="time" style="width: 15.906288532676%"></div>
<pre>
  refine (fcard_equiv (functor_arrow e idmap)^-1 @ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 575
Time: 0.025s">
<div class="time" style="width: 3.0826140567201%"></div>
<pre>
  refine (_ @ ap (fun x =&gt; nat_exp (fcard Y) x) (fcard_equiv e)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 576
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  generalize (fcard X); intros n.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 577
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  induction n as [|n IH].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 578
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 579
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 579
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 580
Time: 0.55s">
<div class="time" style="width: 67.817509247842%"></div>
<pre> refine (fcard_equiv (equiv_sum_ind (fun (_:Fin n.+1) =&gt; Y))^-1 @ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 580
Time: 0.011s">
<div class="time" style="width: 1.3563501849568%"></div>
<pre>
    refine (fcard_prod _ _ @ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 581
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>
    apply (ap011 mult).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 582
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 583
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre> assumption.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 583
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 584
Time: 0.123s">
<div class="time" style="width: 15.166461159063%"></div>
<pre> refine (fcard_equiv (@Unit_ind (fun (_:Unit) =&gt; Y))^-1).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 584
Time: 0.051s">
<div class="time" style="width: 6.288532675709%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 585
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** [fcard] still computes, despite the funext: *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 587
Time: 0.089s">
<div class="time" style="width: 10.974106041924%"></div>
<pre>Goal forall fs:Funext, fcard (Fin 3 -&gt; Fin 4) = 64.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 587
Time: 0.003s">
<div class="time" style="width: 0.36991368680641%"></div>
<pre>
  reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 588
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Abort.

(** *** Automorphism types (i.e. symmetric groups) *)

Global Instance finite_aut `{Funext} X `{Finite X}
: Finite (X &lt;~&gt; X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 594
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 594
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (e := merely_equiv_fin X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 595
Time: 0.042s">
<div class="time" style="width: 5.1787916152898%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 596
Time: 0.107s">
<div class="time" style="width: 13.193588162762%"></div>
<pre>
  refine (finite_equiv _
            (equiv_functor_equiv e^-1 e^-1) _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 598
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  generalize (fcard X); intros n.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 599
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  induction n as [|n IH].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 600
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 601
Time: 0.019s">
<div class="time" style="width: 2.3427866831073%"></div>
<pre> exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 601
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 602
Time: 0.082s">
<div class="time" style="width: 10.110974106042%"></div>
<pre> refine (finite_equiv _ (equiv_fin_equiv n n) _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 602
Time: 0.004s">
<div class="time" style="width: 0.49321824907522%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 603
Time: 0.047s">
<div class="time" style="width: 5.7953144266338%"></div>
<pre>

Definition fcard_aut `{Funext} X `{Finite X}
: fcard (X &lt;~&gt; X) = factorial (fcard X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 606
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 607
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (e := merely_equiv_fin X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 608
Time: 0.088s">
<div class="time" style="width: 10.850801479655%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 609
Time: 0.167s">
<div class="time" style="width: 20.59186189889%"></div>
<pre>
  refine (fcard_equiv
            (equiv_functor_equiv e^-1 e^-1)^-1 @ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 611
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  generalize (fcard X); intros n.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 612
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  induction n as [|n IH].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 613
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 614
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 614
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 615
Time: 0.299s">
<div class="time" style="width: 36.868064118372%"></div>
<pre> refine (fcard_equiv (equiv_fin_equiv n n)^-1 @ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 615
Time: 0.009s">
<div class="time" style="width: 1.1097410604192%"></div>
<pre>
    refine (fcard_prod _ _ @ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 616
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
    apply ap011.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 617
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 618
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 618
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 619
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre> assumption.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 619
Time: 0.03s">
<div class="time" style="width: 3.6991368680641%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 620
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** [fcard] still computes: *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 622
Time: 0.164s">
<div class="time" style="width: 20.221948212084%"></div>
<pre>Goal forall fs:Funext, fcard (Fin 4 &lt;~&gt; Fin 4) = 24.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 622
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
  reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 623
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Abort.

(** ** Finite sums of natural numbers *)

(** Perhaps slightly less obviously, finite sets are also closed under sigmas. *)

Global Instance finite_sigma {X} (Y : X -&gt; Type)
       `{Finite X} `{forall x, Finite (Y x)}
: Finite { x:X &amp; Y x }.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 632
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 632
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (e := merely_equiv_fin X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 633
Time: 0.042s">
<div class="time" style="width: 5.1787916152898%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 634
Time: 0.071s">
<div class="time" style="width: 8.7546239210851%"></div>
<pre>
  refine (finite_equiv' _
            (equiv_functor_sigma (equiv_inverse e)
                                 (fun x (y:Y (e^-1 x)) =&gt; y)) _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 637
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  (** Unfortunately, because [compose] is currently beta-expanded, [set (Y' := Y o e^-1)] doesn't change the goal. *)
 </pre>
</div>
<div class="code" title="File: Finite.v
Line: 639
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>set (Y' := fun x =&gt; Y (e^-1 x)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 639
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
  assert (forall x, Finite (Y' x)) by exact _; clearbody Y'; clear e.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 640
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  generalize dependent (fcard X); intros n Y' ?.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 641
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  induction n as [|n IH].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 642
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 643
Time: 0.017s">
<div class="time" style="width: 2.0961775585697%"></div>
<pre> refine (finite_equiv Empty pr1^-1 _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 643
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 644
Time: 0.096s">
<div class="time" style="width: 11.837237977805%"></div>
<pre> refine (finite_equiv _ (equiv_sigma_sum (Fin n) Unit Y')^-1 _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 644
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply finite_sum.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 645
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 646
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre> apply IH; exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 646
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 647
Time: 0.068s">
<div class="time" style="width: 8.3847102342787%"></div>
<pre> refine (finite_equiv _ (equiv_contr_sigma _)^-1 _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 647
Time: 0.008s">
<div class="time" style="width: 0.98643649815043%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 648
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Amusingly, this automatically gives us a way to add up a family of natural numbers indexed by any finite set.  (We could of course also define such an operation directly, probably using [merely_ind_hset].) *)

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 651
Time: 0.029s">
<div class="time" style="width: 3.5758323057953%"></div>
<pre>Definition finplus {X} `{Finite X} (f : X -&gt; nat) : nat
  := fcard { x:X &amp; Fin (f x) }.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 652
Time: 0.03s">
<div class="time" style="width: 3.6991368680641%"></div>
<pre>

Definition fcard_sigma {X} (Y : X -&gt; Type)
       `{Finite X} `{forall x, Finite (Y x)}
: fcard { x:X &amp; Y x } = finplus (fun x =&gt; fcard (Y x)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 656
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 657
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  set (f := fun x =&gt; fcard (Y x)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 658
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
  set (g := fun x =&gt; merely_equiv_fin (Y x) : merely (Y x &lt;~&gt; Fin (f x))).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 659
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
  apply finite_choice in g.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 660
Time: 0.092s">
<div class="time" style="width: 11.34401972873%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 661
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  unfold finplus.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 662
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
  refine (fcard_equiv' (equiv_functor_sigma' (equiv_idmap X) g)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 663
Time: 0.004s">
<div class="time" style="width: 0.49321824907522%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 664
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** The sum of a finite constant family is the product by its cardinality. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 666
Time: 0.003s">
<div class="time" style="width: 0.36991368680641%"></div>
<pre>Definition finplus_const X `{Finite X} n
: finplus (fun x:X =&gt; n) = fcard X * n.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 667
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 668
Time: 0.032s">
<div class="time" style="width: 3.9457459926017%"></div>
<pre>
  transitivity (fcard (X * Fin n)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 669
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 670
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre> exact (fcard_equiv' (equiv_sigma_prod0 X (Fin n))).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 670
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 671
Time: 0.013s">
<div class="time" style="width: 1.6029593094945%"></div>
<pre> exact (fcard_prod X (Fin n)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 671
Time: 0.005s">
<div class="time" style="width: 0.61652281134402%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 672
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Closure under sigmas and paths also implies closure under hfibers. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 674
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition finite_hfiber {X Y} (f : X -&gt; Y) (y : Y)
       `{Finite X} `{Finite Y}
: Finite (hfiber f y).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 676
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 677
Time: 0.038s">
<div class="time" style="width: 4.6855733662145%"></div>
<pre>
  exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 678
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 679
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Therefore, the cardinality of the domain of a map between finite sets is the sum of the cardinalities of its hfibers. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 681
Time: 0.05s">
<div class="time" style="width: 6.1652281134402%"></div>
<pre>Definition fcard_domain {X Y} (f : X -&gt; Y) `{Finite X} `{Finite Y}
: fcard X = finplus (fun y =&gt; fcard (hfiber f y)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 682
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 683
Time: 0.007s">
<div class="time" style="width: 0.86313193588163%"></div>
<pre>
  refine (_ @ fcard_sigma (hfiber f)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 684
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
  refine (fcard_equiv' (equiv_fibration_replacement f)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 685
Time: 0.004s">
<div class="time" style="width: 0.49321824907522%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 686
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** In particular, the image of a map between finite sets is finite. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 688
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>Definition finite_image
       {X Y} `{Finite X} `{Finite Y} (f : X -&gt; Y)
: Finite (himage f).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 690
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 691
Time: 0.093s">
<div class="time" style="width: 11.467324290999%"></div>
<pre>
  exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 692
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 693
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Finite products of natural numbers *)

(** Similarly, closure of finite sets under [forall] automatically gives us a way to multiply a family of natural numbers indexed by any finite set.  Of course, if we defined this explicitly, it wouldn't need funext. *)

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 698
Time: 0.05s">
<div class="time" style="width: 6.1652281134402%"></div>
<pre>Definition finmult `{Funext} {X} `{Finite X} (f : X -&gt; nat) : nat
  := fcard (forall x:X, Fin (f x)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 699
Time: 0.055s">
<div class="time" style="width: 6.7817509247842%"></div>
<pre>

Definition fcard_forall `{Funext} {X} (Y : X -&gt; Type)
       `{Finite X} `{forall x, Finite (Y x)}
: fcard (forall x:X, Y x) = finmult (fun x =&gt; fcard (Y x)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 703
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 704
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
  set (f := fun x =&gt; fcard (Y x)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 705
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
  set (g := fun x =&gt; merely_equiv_fin (Y x) : merely (Y x &lt;~&gt; Fin (f x))).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 706
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
  apply finite_choice in g.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 707
Time: 0.159s">
<div class="time" style="width: 19.60542540074%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 708
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  unfold finmult.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 709
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>
  refine (fcard_equiv' (equiv_functor_forall' (equiv_idmap X) g)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 710
Time: 0.007s">
<div class="time" style="width: 0.86313193588163%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 711
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** The product of a finite constant family is the exponential by its cardinality. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 713
Time: 0.005s">
<div class="time" style="width: 0.61652281134402%"></div>
<pre>Definition finmult_const `{Funext} X `{Finite X} n
: finmult (fun x:X =&gt; n) = nat_exp n (fcard X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 714
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 715
Time: 0.18s">
<div class="time" style="width: 22.194821208385%"></div>
<pre>
  refine (fcard_arrow X (Fin n)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 716
Time: 0.006s">
<div class="time" style="width: 0.73982737361282%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 717
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>


(** ** Finite subsets *)

(** Closure under sigmas implies that a detachable subset of a finite set is finite. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 722
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>Global Instance finite_detachable_subset {X} `{Finite X} (P : X -&gt; Type)
       `{forall x, IsHProp (P x)} `{forall x, Decidable (P x)}
: Finite { x:X &amp; P x }.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 724
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 725
Time: 0.023s">
<div class="time" style="width: 2.8360049321825%"></div>
<pre>
  exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 726
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 727
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Conversely, if a subset of a finite set is finite, then it is detachable.  We show first that an embedding between finite subsets has detachable image. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 729
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>Definition detachable_image_finite
           {X Y} `{Finite X} `{Finite Y} (f : X -&gt; Y) `{IsEmbedding f}
: forall y, Decidable (hfiber f y).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 731
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 732
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros y.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 733
Time: 0.044s">
<div class="time" style="width: 5.4254007398274%"></div>
<pre>
  assert (ff : Finite (hfiber f y)) by exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 734
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
  destruct ff as [[|n] e].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 735
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 736
Time: 0.155s">
<div class="time" style="width: 19.112207151665%"></div>
<pre> right; intros u; strip_truncations; exact (e u).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 736
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 737
Time: 0.161s">
<div class="time" style="width: 19.852034525277%"></div>
<pre> left; strip_truncations; exact (e^-1 (inr tt)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 737
Time: 0.004s">
<div class="time" style="width: 0.49321824907522%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 738
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>

Definition detachable_finite_subset {X} `{Finite X}
           (P : X -&gt; Type) `{forall x, IsHProp (P x)}
           {Pf : Finite ({ x:X &amp; P x })}
: forall x, Decidable (P x).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 743
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 744
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros x.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 745
Time: 0.242s">
<div class="time" style="width: 29.839704069051%"></div>
<pre>
  refine (decidable_equiv _ (hfiber_fibration x P)^-1 _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 746
Time: 0.034s">
<div class="time" style="width: 4.1923551171393%"></div>
<pre>
  refine (detachable_image_finite pr1 x).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 747
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 748
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> assumption.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 748
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>                 (** Why doesn't Coq find this? *)
 </pre>
</div>
<div class="code" title="File: Finite.v
Line: 749
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>-</pre>
</div>
<div class="code" title="File: Finite.v
Line: 749
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre> apply mapinO_pr1; exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 749
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>  (** Why doesn't Coq find this? *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 749
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 749
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Quotients *)

(** The quotient of a finite set by a detachable equivalence relation is finite. *)

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 754
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Section DecidableQuotients.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 754
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
  Context `{Univalence} {X} `{Finite X}
          (R : relation X) `{is_mere_relation X R}
          `{Reflexive _ R} `{Transitive _ R} `{Symmetric _ R}
          {Rd : forall x y, Decidable (R x y)}.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 758
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Global Instance finite_quotient : Finite (quotient R).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 760
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 761
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    assert (e := merely_equiv_fin X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 762
Time: 0.153s">
<div class="time" style="width: 18.865598027127%"></div>
<pre>
    strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 763
Time: 0.018s">
<div class="time" style="width: 2.2194821208385%"></div>
<pre>
    pose (R' x y := R (e^-1 x) (e^-1 y)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 764
Time: 0.005s">
<div class="time" style="width: 0.61652281134402%"></div>
<pre>
    assert (is_mere_relation _ R') by exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 765
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    assert (Reflexive R') by (intros ?; unfold R'; apply reflexivity).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 766
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    assert (Symmetric R') by (intros ? ?; unfold R'; apply symmetry).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 767
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
    assert (Transitive R') by (intros ? ? ?; unfold R'; apply transitivity).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 768
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    assert (R'd : forall x y, Decidable (R' x y)) by (intros ? ?; unfold R'; apply Rd).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 769
Time: 0.112s">
<div class="time" style="width: 13.810110974106%"></div>
<pre>
    simple refine (finite_equiv' (quotient R') (quotient_functor_equiv R' R e^-1 _) _); try exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 770
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 771
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros x y; split; apply idmap.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 771
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 771
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    clearbody R'; clear e.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 772
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>
    generalize dependent (fcard X);
      intros n; induction n as [|n IH]; intros R' ? ? ? ? ?.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 774
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 775
Time: 0.017s">
<div class="time" style="width: 2.0961775585697%"></div>
<pre> refine (finite_equiv Empty _^-1 _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 775
Time: 0.008s">
<div class="time" style="width: 0.98643649815043%"></div>
<pre>
      refine (quotient_rec R' Empty_rec (fun x _ _ =&gt; match x with end)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 776
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 777
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> pose (R'' x y := R' (inl x) (inl y)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 777
Time: 0.008s">
<div class="time" style="width: 0.98643649815043%"></div>
<pre>
      assert (is_mere_relation _ R'') by exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 778
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
      assert (Reflexive R'') by (intros ?; unfold R''; apply reflexivity).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 779
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
      assert (Symmetric R'') by (intros ? ?; unfold R''; apply symmetry).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 780
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
      assert (Transitive R'') by (intros ? ? ?; unfold R''; apply transitivity).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 781
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      assert (forall x y, Decidable (R'' x y)) by (intros ? ?; unfold R''; apply R'd).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 782
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
      assert (inlresp := (fun x y =&gt; idmap)
                         : forall x y, R'' x y -&gt; R' (inl x) (inl y)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 784
Time: 0.072s">
<div class="time" style="width: 8.8779284833539%"></div>
<pre>
      destruct (dec (merely {x:Fin n &amp; R' (inl x) (inr tt)})) as [p|np].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 785
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 786
Time: 0.811s">
<div class="time" style="width: 100%"></div>
<pre> strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 786
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
        destruct p as [x r].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 787
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>
        refine (finite_equiv' (quotient R'') _ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 788
Time: 0.043s">
<div class="time" style="width: 5.3020961775586%"></div>
<pre>
        refine (BuildEquiv _ _ (quotient_functor R'' R' inl inlresp) _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 789
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        apply isequiv_surj_emb.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 790
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 791
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply BuildIsSurjection.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 791
Time: 0.03s">
<div class="time" style="width: 3.6991368680641%"></div>
<pre>
          refine (quotient_ind_prop R' _ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 792
Time: 0.004s">
<div class="time" style="width: 0.49321824907522%"></div>
<pre>
          intros [y|[]]; apply tr.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 793
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 794
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre> exists (class_of R'' y); reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 794
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 795
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre> exists (class_of R'' x); simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 795
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
            apply related_classes_eq, r.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 796
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 797
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre> apply isembedding_isinj_hset; intros u.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 797
Time: 0.083s">
<div class="time" style="width: 10.234278668311%"></div>
<pre>
          refine (quotient_ind_prop R'' _ _); intros v.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 798
Time: 0.084s">
<div class="time" style="width: 10.35758323058%"></div>
<pre>
          revert u; refine (quotient_ind_prop R'' _ _); intros u.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 799
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          simpl; intros q.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 800
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          apply related_classes_eq; unfold R''.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 801
Time: 0.003s">
<div class="time" style="width: 0.36991368680641%"></div>
<pre>
          exact (classes_eq_related R' (inl u) (inl v) q).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 802
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 802
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 803
Time: 0.004s">
<div class="time" style="width: 0.49321824907522%"></div>
<pre> refine (finite_equiv' (quotient R'' + Unit) _ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 803
Time: 0.043s">
<div class="time" style="width: 5.3020961775586%"></div>
<pre>
        refine (BuildEquiv _ _ (sum_ind (fun _ =&gt; quotient R')
                                        (quotient_functor R'' R' inl inlresp)
                                        (fun _ =&gt; class_of R' (inr tt))) _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 806
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
        apply isequiv_surj_emb.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 807
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 808
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre> apply BuildIsSurjection.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 808
Time: 0.038s">
<div class="time" style="width: 4.6855733662145%"></div>
<pre>
          refine (quotient_ind_prop R' _ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 809
Time: 0.005s">
<div class="time" style="width: 0.61652281134402%"></div>
<pre>
          intros [y|[]]; apply tr.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 810
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 811
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre> exists (inl (class_of R'' y)); reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 811
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 812
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre> exists (inr tt); reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 812
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 813
Time: 0.048s">
<div class="time" style="width: 5.9186189889026%"></div>
<pre> apply isembedding_isinj_hset; intros u.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 813
Time: 0.004s">
<div class="time" style="width: 0.49321824907522%"></div>
<pre>
          refine (sum_ind _ _ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 814
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 815
Time: 0.143s">
<div class="time" style="width: 17.632552404439%"></div>
<pre> refine (quotient_ind_prop R'' _ _); intros v.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 815
Time: 0.005s">
<div class="time" style="width: 0.61652281134402%"></div>
<pre>
            revert u; refine (sum_ind _ _ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 816
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
            *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 817
Time: 0.147s">
<div class="time" style="width: 18.125770653514%"></div>
<pre> refine (quotient_ind_prop R'' _ _); intros u.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 817
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
              simpl; intros q.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 818
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
              apply ap, related_classes_eq; unfold R''.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 819
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>
              exact (classes_eq_related R' (inl u) (inl v) q).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 820
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
            *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 821
Time: 0.003s">
<div class="time" style="width: 0.36991368680641%"></div>
<pre> intros []; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 821
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
              intros q.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 822
Time: 0.003s">
<div class="time" style="width: 0.36991368680641%"></div>
<pre>
              apply classes_eq_related in q; try exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 823
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
              apply symmetry in q.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 824
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>
              elim (np (tr (v ; q))).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 825
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 826
Time: 0.007s">
<div class="time" style="width: 0.86313193588163%"></div>
<pre> intros []; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 826
Time: 0.007s">
<div class="time" style="width: 0.86313193588163%"></div>
<pre>
            destruct u as [u|[]]; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 827
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
            *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 828
Time: 0.14s">
<div class="time" style="width: 17.262638717633%"></div>
<pre> revert u; refine (quotient_ind_prop R'' _ _); intros u; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 828
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
              intros q.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 829
Time: 0.003s">
<div class="time" style="width: 0.36991368680641%"></div>
<pre>
              apply classes_eq_related in q; try exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 830
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>
              elim (np (tr (u;q))).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 831
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
            *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 832
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros; reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 832
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 832
Time: 0.11s">
<div class="time" style="width: 13.563501849568%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 833
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Therefore, the cardinality of [X] is the sum of the cardinalities of its equivalence classes. *)
 </pre>
</div>
<div class="code" title="File: Finite.v
Line: 836
Time: 0.133s">
<div class="time" style="width: 16.399506781751%"></div>
<pre>Definition fcard_quotient
  : fcard X = finplus (fun z:quotient R =&gt; fcard {x:X &amp; in_class R z x}).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 837
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 838
Time: 0.012s">
<div class="time" style="width: 1.4796547472256%"></div>
<pre>
    refine (fcard_domain (class_of R) @ _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 839
Time: 0.007s">
<div class="time" style="width: 0.86313193588163%"></div>
<pre>
    apply ap, path_arrow; intros z; revert z.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 840
Time: 0.115s">
<div class="time" style="width: 14.180024660912%"></div>
<pre>
    refine (quotient_ind_prop _ _ _); intros x; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 841
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>
    apply fcard_equiv'; unfold hfiber.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 842
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
    refine (equiv_functor_sigma' 1 _); intros y; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 843
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
    refine (_ oE sets_exact R y x).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 844
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
    apply equiv_iff_hprop; apply symmetry.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 845
Time: 0.023s">
<div class="time" style="width: 2.8360049321825%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 846
Time: 0.048s">
<div class="time" style="width: 5.9186189889026%"></div>
<pre>

End DecidableQuotients.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 848
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Injections *)

(** An injection between finite sets induces an inequality between their cardinalities. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 852
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>Definition leq_inj_finite `{Funext} {X Y} {fX : Finite X} {fY : Finite Y}
           (f : X -&gt; Y) (i : IsEmbedding f)
: fcard X &lt;= fcard Y.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 854
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 855
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
  assert (MapIn -1 f) by exact _.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 856
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> clear i.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 856
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
  destruct fX as [n e]; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 857
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
  destruct fY as [m e']; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 858
Time: 0.137s">
<div class="time" style="width: 16.892725030826%"></div>
<pre>
  strip_truncations.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 859
Time: 0.01s">
<div class="time" style="width: 1.233045622688%"></div>
<pre>
  pose (g := e' o f o e^-1).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 860
Time: 0.164s">
<div class="time" style="width: 20.221948212084%"></div>
<pre>
  assert (MapIn -1 g) by (unfold g; exact _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 861
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  clearbody g.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 862
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> clear e e'.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 862
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> generalize dependent m.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 862
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  induction n as [|n IHn].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 863
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 864
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros; exact tt.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 864
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 864
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros m g ?.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 865
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>
  assert (i : isinj g) by (apply isinj_embedding; exact _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 866
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
  destruct m as [|m].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 867
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 868
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> elim (g (inr tt)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 868
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 868
Time: 0.058s">
<div class="time" style="width: 7.1516646115906%"></div>
<pre>
  pose (h := (fin_transpose_last_with m (g (inr tt)))^-1 o g).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 869
Time: 0.149s">
<div class="time" style="width: 18.372379778052%"></div>
<pre>
  assert (MapIn -1 h) by (unfold h; exact _).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 870
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (Ha : forall a:Fin n, is_inl (h (inl a))).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 871
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 872
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros a.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 872
Time: 0.003s">
<div class="time" style="width: 0.36991368680641%"></div>
<pre>
    remember (g (inl a)) as b eqn:p.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 873
Time: 0.003s">
<div class="time" style="width: 0.36991368680641%"></div>
<pre>
    destruct b as [b|[]].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 874
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 875
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> assert (q : g (inl a) &lt;&gt; (g (inr tt))).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 875
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 876
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros r.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 876
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (inl_ne_inr _ _ (i _ _ r)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 876
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 876
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
      rewrite p in q; apply symmetric_neq in q.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 877
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      assert (r : h (inl a) = inl b).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 878
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 879
Time: 0.005s">
<div class="time" style="width: 0.61652281134402%"></div>
<pre> unfold h; apply moveR_equiv_V; symmetry.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 879
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>
        refine (fin_transpose_last_with_rest m (g (inr tt)) b q @ p^).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 880
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 880
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      rewrite r; exact tt.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 881
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 882
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> assert (q : h (inl a) = g (inr tt)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 882
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 883
Time: 0.005s">
<div class="time" style="width: 0.61652281134402%"></div>
<pre> unfold h; apply moveR_equiv_V; symmetry.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 883
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>
        refine (_ @ p^); apply fin_transpose_last_with_with.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 884
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 884
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      rewrite q.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 885
Time: 0.005s">
<div class="time" style="width: 0.61652281134402%"></div>
<pre>
      destruct (is_inl_or_is_inr (g (inr tt))) as [l|r]; try assumption.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 886
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      assert (s := inr_un_inr _ r).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 887
Time: 0.003s">
<div class="time" style="width: 0.36991368680641%"></div>
<pre>
      revert s; generalize (un_inr (g (inr tt)) r); intros [] s.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 888
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>
      elim (inl_ne_inr _ _ (i _ _ (p @ s))).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 889
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 889
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (Hb : forall b:Unit, is_inr (h (inr b))).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 890
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 891
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros [].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 891
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    assert (q : h (inr tt) = inr tt).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 892
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    {</pre>
</div>
<div class="code" title="File: Finite.v
Line: 893
Time: 0.006s">
<div class="time" style="width: 0.73982737361282%"></div>
<pre> unfold h; apply moveR_equiv_V; symmetry.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 893
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply fin_transpose_last_with_last.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 894
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 894
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    rewrite q; exact tt.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 895
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: Finite.v
Line: 895
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>
  exact (IHn m (unfunctor_sum_l h Ha)
             (mapinO_unfunctor_sum_l -1 h Ha Hb)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 897
Time: 0.025s">
<div class="time" style="width: 3.0826140567201%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 898
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Initial segments of [nat] *)

</pre>
</div>
<div class="code" title="File: Finite.v
Line: 901
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition nat_fin (n : nat) (k : Fin n) : nat.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 901
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 902
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  induction n as [|n nf].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 903
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 904
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> contradiction.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 904
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 905
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre> destruct k as [k|_].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 905
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 906
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (nf k).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 906
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 907
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact n.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 907
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 908
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>

Definition nat_fin_inl (n : nat) (k : Fin n)
: nat_fin n.+1 (inl k) = nat_fin n k
  := 1.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 912
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition nat_fin_compl (n : nat) (k : Fin n) : nat.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 914
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 915
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  induction n as [|n nfc].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 916
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 917
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> contradiction.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 917
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 918
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre> destruct k as [k|_].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 918
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 919
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (nfc k).+1.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 919
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 920
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact 0.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 920
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 921
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition nat_fin_compl_compl n k
: (nat_fin n k + nat_fin_compl n k).+1 = n.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 924
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 925
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  induction n as [|n IH].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 926
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 927
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> contradiction.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 927
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 928
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre> destruct k as [k|?]; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 928
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 929
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> rewrite nat_plus_comm.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 929
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      specialize (IH k).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 930
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      rewrite nat_plus_comm in IH.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 931
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact (ap S IH).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 932
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 933
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> rewrite nat_plus_comm; reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 933
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 934
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Enumerations *)

(** A function from [nat] to a finite set must repeat itself eventually. *)</pre>
</div>
<div class="code" title="File: Finite.v
Line: 938
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Section Enumeration.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 938
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context `{Funext} {X} `{Finite X} (e : nat -&gt; X).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 939
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Let er (n : nat) : Fin n -&gt; X
    := fun k =&gt; e (nat_fin n k).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 942
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Lemma finite_enumeration_stage (n : nat)
  : IsEmbedding (er n)
    + { n : nat &amp; { k : nat &amp; e n = e (n + k).+1 }}.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 946
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 947
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
    induction n as [|n [IH|IH]].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 948
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 949
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> left.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 949
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros x.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 949
Time: 0.001s">
<div class="time" style="width: 0.1233045622688%"></div>
<pre>
      apply hprop_inhabited_contr; intros [[] _].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 950
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 951
Time: 0.008s">
<div class="time" style="width: 0.98643649815043%"></div>
<pre> destruct (detachable_image_finite (er n) (er n.+1 (inr tt)))
        as [[k p]|ne].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 952
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 953
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> right.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 953
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        exists (nat_fin n k).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 954
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        exists (nat_fin_compl n k).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 955
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        rewrite nat_fin_compl_compl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 956
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        exact p.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 957
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: Finite.v
Line: 958
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> left.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 958
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros x.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 958
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        apply hprop_allpath.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 959
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        intros k l.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 960
Time: 0.089s">
<div class="time" style="width: 10.974106041924%"></div>
<pre>
        apply path_sigma_hprop.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 961
Time: 0.012s">
<div class="time" style="width: 1.4796547472256%"></div>
<pre>
        destruct k as [[k|[]] p], l as [[l|[]] q]; simpl.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 962
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 963
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply isinj_embedding in IH.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 963
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          apply ap.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 964
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          apply IH.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 965
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          unfold er in p, q.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 966
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> simpl in p, q.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 966
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          exact (p @ q^).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 967
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 968
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> refine (Empty_rec (ne _)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 968
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          exists k.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 969
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          exact (p @ q^).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 970
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 971
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> refine (Empty_rec (ne _)).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 971
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          exists l.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 972
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          exact (q @ p^).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 973
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        *</pre>
</div>
<div class="code" title="File: Finite.v
Line: 974
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> reflexivity.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 974
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 975
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> right; exact IH.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 975
Time: 0.015s">
<div class="time" style="width: 1.8495684340321%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 976
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition finite_enumeration_repeats
  : { n : nat &amp; { k : nat &amp; e n = e (n + k).+1 }}.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 979
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 980
Time: 0.003s">
<div class="time" style="width: 0.36991368680641%"></div>
<pre>
    destruct (finite_enumeration_stage (fcard X).+1) as [p|?].</pre>
</div>
<div class="code" title="File: Finite.v
Line: 981
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 982
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre> assert (q := leq_inj_finite (er (fcard X).+1) p); simpl in q.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 982
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      elim (not_nltn _ q).</pre>
</div>
<div class="code" title="File: Finite.v
Line: 983
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Finite.v
Line: 984
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> assumption.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 984
Time: 0.002s">
<div class="time" style="width: 0.24660912453761%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 985
Time: 0.007s">
<div class="time" style="width: 0.86313193588163%"></div>
<pre>

End Enumeration.</pre>
</div>
<div class="code" title="File: Finite.v
Line: 988
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

</pre>
</div>
</body>
</html>

